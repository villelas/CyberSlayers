{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\frenz\\\\OneDrive\\\\Desktop\\\\CyberSlayers\\\\frontend\\\\src\\\\pages\\\\PasswordGame.jsx\",\n  _s = $RefreshSig$();\n// BossFight.jsx\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport Lagdrakul2A from \"../assets/Lagdrakul2A.png\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst GAME_WIDTH = 800;\nconst GAME_HEIGHT = 550;\nconst BATTLE_BOX = {\n  x: 250,\n  y: 180,\n  width: 300,\n  height: 260\n};\nconst PLAYER_SIZE = 18;\nconst PLAYER_SPEED = 5;\nconst STAGE_ONE_DURATION = 20000;\nconst STAGE_TWO_DURATION = 25000;\nconst DASHBOARD_ROUTE = \"/dashboard\";\n\n// This boss fight is thematically Act IV – The Polluted Well (Module 4).\n// If you hook it to a different node on the map, update this number.\nconst GAME_NUM_FOR_STORY = 6;\nfunction clamp(value, min, max) {\n  return Math.max(min, Math.min(max, value));\n}\n\n// Remember last chosen pattern per stage so we don't spam the same one\nlet lastStage1Pattern = null;\nlet lastStage2Pattern = null;\n\n// Helper: apply hidden safe zone filter\nfunction bulletInSafeZone(bullet, safeZone) {\n  var _bullet$width, _bullet$height;\n  if (!safeZone) return false;\n  const {\n    x,\n    y,\n    width,\n    height\n  } = bullet;\n  const bx2 = x + ((_bullet$width = bullet.width) !== null && _bullet$width !== void 0 ? _bullet$width : 0);\n  const by2 = y + ((_bullet$height = bullet.height) !== null && _bullet$height !== void 0 ? _bullet$height : 0);\n  const sx1 = safeZone.x;\n  const sy1 = safeZone.y;\n  const sx2 = safeZone.x + safeZone.width;\n  const sy2 = safeZone.y + safeZone.height;\n  return !(bx2 < sx1 || x > sx2 || by2 < sy1 || y > sy2);\n}\nfunction BossFight() {\n  _s();\n  const navigate = useNavigate();\n  const [gameState, setGameState] = useState(\"intro\");\n  const [playerPos, setPlayerPos] = useState({\n    x: BATTLE_BOX.x + BATTLE_BOX.width / 2 - PLAYER_SIZE / 2,\n    y: BATTLE_BOX.y + BATTLE_BOX.height / 2 - PLAYER_SIZE / 2\n  });\n  const [bossHealth, setBossHealth] = useState(100);\n  const [bossBullets, setBossBullets] = useState([]);\n  const [hitsTaken, setHitsTaken] = useState(0);\n\n  // Energy shields\n  const [shields, setShields] = useState([]);\n  const shieldsRef = useRef([]);\n  const shieldInvulnUntilRef = useRef(0);\n  const lastShieldSpawnRef = useRef(0);\n\n  // Hidden safe zone (about 1/8th area of battle box, no bullets spawn here)\n  const safeZoneRef = useRef(null);\n  const keysRef = useRef({});\n  const playerPosRef = useRef(playerPos);\n  const lastAttackRef = useRef(0);\n  const stageStartRef = useRef(0);\n  const stageRef = useRef(1); // 1 or 2\n\n  // Keep refs updated\n  useEffect(() => {\n    playerPosRef.current = playerPos;\n  }, [playerPos]);\n\n  // Spawn a shield pickup somewhere inside the battle box\n  const spawnShield = () => {\n    const margin = 20;\n    const radius = 12;\n    const x = BATTLE_BOX.x + margin + Math.random() * (BATTLE_BOX.width - 2 * margin);\n    const y = BATTLE_BOX.y + margin + Math.random() * (BATTLE_BOX.height - 2 * margin);\n    const shield = {\n      id: `shield-${performance.now()}-${Math.random()}`,\n      x,\n      y,\n      radius\n    };\n    const next = [...shieldsRef.current, shield];\n    shieldsRef.current = next;\n    setShields(next);\n  };\n\n  // Keyboard handling (prevent scroll + phase transitions)\n  useEffect(() => {\n    const handleKeyDown = e => {\n      const isArrow = e.key === \"ArrowUp\" || e.key === \"ArrowDown\" || e.key === \"ArrowLeft\" || e.key === \"ArrowRight\";\n\n      // prevent page from scrolling when using arrows\n      if (isArrow) {\n        e.preventDefault();\n      }\n\n      // Midbreak → any key continues to Phase II\n      if (gameState === \"midbreak\") {\n        if (![\"Shift\", \"Meta\", \"Alt\", \"Control\"].includes(e.key)) {\n          e.preventDefault();\n          startFightStage2();\n        }\n        return;\n      }\n      keysRef.current[e.key] = true;\n      if (gameState === \"intro\" && e.key === \"Enter\") {\n        e.preventDefault();\n        startFightStage1();\n      }\n    };\n    const handleKeyUp = e => {\n      keysRef.current[e.key] = false;\n    };\n    window.addEventListener(\"keydown\", handleKeyDown);\n    window.addEventListener(\"keyup\", handleKeyUp);\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n      window.removeEventListener(\"keyup\", handleKeyUp);\n    };\n  }, [gameState]);\n  const resetPlayerPosition = () => {\n    const base = {\n      x: BATTLE_BOX.x + BATTLE_BOX.width / 2 - PLAYER_SIZE / 2,\n      y: BATTLE_BOX.y + BATTLE_BOX.height / 2 - PLAYER_SIZE / 2\n    };\n    setPlayerPos(base);\n    playerPosRef.current = base;\n  };\n  const resetShieldsAndSafeZone = () => {\n    shieldsRef.current = [];\n    setShields([]);\n    shieldInvulnUntilRef.current = 0;\n    lastShieldSpawnRef.current = performance.now();\n\n    // Hidden safe rectangle ≈ 1/8 of the battle box area\n    const zoneWidth = BATTLE_BOX.width / 4; // width * height/2 = 1/8 area\n    const zoneHeight = BATTLE_BOX.height / 2;\n    const x = BATTLE_BOX.x + Math.random() * (BATTLE_BOX.width - zoneWidth);\n    const y = BATTLE_BOX.y + Math.random() * (BATTLE_BOX.height - zoneHeight);\n    safeZoneRef.current = {\n      x,\n      y,\n      width: zoneWidth,\n      height: zoneHeight\n    };\n  };\n  const startFightStage1 = () => {\n    stageRef.current = 1;\n    stageStartRef.current = performance.now();\n    lastAttackRef.current = performance.now();\n    setBossBullets([]);\n    resetPlayerPosition();\n    setBossHealth(100);\n    setHitsTaken(0); // reset hit tally at start of run\n    resetShieldsAndSafeZone();\n    setGameState(\"playing\");\n  };\n  const startFightStage2 = () => {\n    stageRef.current = 2;\n    stageStartRef.current = performance.now();\n    lastAttackRef.current = performance.now();\n    setBossBullets([]);\n    resetPlayerPosition();\n    resetShieldsAndSafeZone();\n    setGameState(\"playing\");\n  };\n  const handleReplay = () => {\n    startFightStage1();\n  };\n\n  // exit can optionally mark a successful completion for the dashboard story system\n  const handleExit = (isSuccessful = false) => {\n    if (isSuccessful) {\n      try {\n        localStorage.setItem(\"cyberslayers_last_completed_game\", String(GAME_NUM_FOR_STORY));\n        localStorage.setItem(\"cyberslayers_last_completion_status\", \"success\");\n      } catch (e) {\n        // fail silently; navigation still happens\n      }\n    }\n    navigate(DASHBOARD_ROUTE);\n  };\n\n  // Main game loop\n  useEffect(() => {\n    if (gameState !== \"playing\") return;\n    let animationId;\n    let lastFrame = performance.now();\n    const loop = time => {\n      const dt = time - lastFrame;\n      lastFrame = time;\n\n      // Move player\n      setPlayerPos(prev => {\n        let nx = prev.x;\n        let ny = prev.y;\n        const k = keysRef.current;\n        if (k[\"ArrowLeft\"] || k[\"a\"] || k[\"A\"]) {\n          nx -= PLAYER_SPEED;\n        }\n        if (k[\"ArrowRight\"] || k[\"d\"] || k[\"D\"]) {\n          nx += PLAYER_SPEED;\n        }\n        if (k[\"ArrowUp\"] || k[\"w\"] || k[\"W\"]) {\n          ny -= PLAYER_SPEED;\n        }\n        if (k[\"ArrowDown\"] || k[\"s\"] || k[\"S\"]) {\n          ny += PLAYER_SPEED;\n        }\n        nx = clamp(nx, BATTLE_BOX.x, BATTLE_BOX.x + BATTLE_BOX.width - PLAYER_SIZE);\n        ny = clamp(ny, BATTLE_BOX.y, BATTLE_BOX.y + BATTLE_BOX.height - PLAYER_SIZE);\n        const nextPos = {\n          x: nx,\n          y: ny\n        };\n        playerPosRef.current = nextPos;\n        return nextPos;\n      });\n      const stage = stageRef.current;\n      const stageDuration = stage === 1 ? STAGE_ONE_DURATION : STAGE_TWO_DURATION;\n      const elapsed = performance.now() - stageStartRef.current;\n      const stageT = clamp(elapsed / stageDuration, 0, 1);\n\n      // Stage transitions\n      if (stage === 1 && elapsed >= STAGE_ONE_DURATION) {\n        setGameState(\"midbreak\");\n        cancelAnimationFrame(animationId);\n        return;\n      }\n      if (stage === 2 && elapsed >= STAGE_TWO_DURATION) {\n        setGameState(\"win\");\n        cancelAnimationFrame(animationId);\n        return;\n      }\n\n      // Boss health progression: Stage 1 → 100→50, Stage 2 → 50→0\n      let newHealth;\n      if (stage === 1) {\n        const ratio = Math.max(0, 1 - stageT); // 1 → 0\n        newHealth = 50 + Math.round(ratio * 50); // 100 → 50\n      } else {\n        const ratio = Math.max(0, 1 - stageT);\n        newHealth = Math.round(ratio * 50); // 50 → 0\n      }\n      if (newHealth !== bossHealth) {\n        setBossHealth(newHealth);\n      }\n      const now = performance.now();\n\n      // Spawn shields regularly; a bit faster in Stage 2, cap total on screen\n      const shieldInterval = stage === 1 ? 5500 : 4000;\n      if (now - lastShieldSpawnRef.current >= shieldInterval && shieldsRef.current.length < 3) {\n        spawnShield();\n        lastShieldSpawnRef.current = now;\n      }\n\n      // Player picking up shields → 1 sec of invulnerability\n      if (shieldsRef.current.length > 0) {\n        const player = playerPosRef.current;\n        const pxCenter = player.x + PLAYER_SIZE / 2;\n        const pyCenter = player.y + PLAYER_SIZE / 2;\n        let changed = false;\n        const remaining = [];\n        for (const s of shieldsRef.current) {\n          const dx = pxCenter - s.x;\n          const dy = pyCenter - s.y;\n          const distSq = dx * dx + dy * dy;\n          const r = s.radius + PLAYER_SIZE * 0.4;\n          if (distSq <= r * r) {\n            // picked up\n            shieldInvulnUntilRef.current = now + 1000; // 1 second\n            changed = true;\n          } else {\n            remaining.push(s);\n          }\n        }\n        if (changed) {\n          shieldsRef.current = remaining;\n          setShields(remaining);\n        }\n      }\n\n      // Attack frequency ramps up per stage, plus a small \"breathing\" pause\n      let attackInterval;\n      if (stage === 1) {\n        attackInterval = stageT < 0.5 ? 1000 : 850; // slightly slower overall\n      } else {\n        attackInterval = stageT < 0.4 ? 720 : 560;\n      }\n      // Extra pause after each pattern so it’s not perfectly continuous\n      const extraPause = stage === 1 ? 160 : 120;\n      const effectiveInterval = attackInterval + extraPause;\n      if (now - lastAttackRef.current >= effectiveInterval) {\n        spawnAttack(stage, stageT, setBossBullets, safeZoneRef.current);\n        lastAttackRef.current = now;\n      }\n\n      // Update bullets + collisions\n      setBossBullets(prev => {\n        const updated = [];\n        let tookHit = false;\n        const player = playerPosRef.current;\n        const px1 = player.x;\n        const py1 = player.y;\n        const px2 = player.x + PLAYER_SIZE;\n        const py2 = player.y + PLAYER_SIZE;\n        const clock = performance.now();\n        const shieldInvulnActive = clock < shieldInvulnUntilRef.current;\n        let shieldsChanged = false;\n        let shieldArr = shieldsRef.current;\n        for (const b of prev) {\n          const nx = b.x + b.vx;\n          const ny = b.y + b.vy;\n\n          // lifetime-based bullets (lasers/warnings)\n          if (b.lifeMs != null && b.bornAt != null) {\n            if (clock - b.bornAt > b.lifeMs) continue;\n          }\n\n          // Bounds check around battle box with margin\n          if (nx + b.width < BATTLE_BOX.x - 40 || nx > BATTLE_BOX.x + BATTLE_BOX.width + 40 || ny + b.height < BATTLE_BOX.y - 40 || ny > BATTLE_BOX.y + BATTLE_BOX.height + 40) {\n            continue;\n          }\n          const bx1 = nx;\n          const by1 = ny;\n          const bx2 = nx + b.width;\n          const by2 = ny + b.height;\n\n          // Lasers destroy shields (but warnings do not)\n          if (b.isLaser && shieldArr.length > 0 && !b.isWarning) {\n            const remainingShields = [];\n            for (const s of shieldArr) {\n              const sx1 = s.x - s.radius;\n              const sy1 = s.y - s.radius;\n              const sx2 = s.x + s.radius;\n              const sy2 = s.y + s.radius;\n              const shieldHit = bx1 < sx2 && bx2 > sx1 && by1 < sy2 && by2 > sy1;\n              if (!shieldHit) {\n                remainingShields.push(s);\n              } else {\n                shieldsChanged = true;\n              }\n            }\n            shieldArr = remainingShields;\n          }\n          const collide = !b.isWarning &&\n          // warnings do NOT hurt\n          !tookHit &&\n          // only one hit per frame\n          !shieldInvulnActive &&\n          // energy shield invulnerability\n          bx1 < px2 && bx2 > px1 && by1 < py2 && by2 > py1;\n          if (collide) {\n            tookHit = true;\n            setHitsTaken(h => h + 1);\n            continue; // bullet consumed\n          }\n          updated.push({\n            ...b,\n            x: nx,\n            y: ny\n          });\n        }\n        if (shieldsChanged) {\n          shieldsRef.current = shieldArr;\n          setShields(shieldArr);\n        }\n        return updated;\n      });\n      animationId = requestAnimationFrame(loop);\n    };\n    animationId = requestAnimationFrame(loop);\n    return () => cancelAnimationFrame(animationId);\n  }, [gameState, bossHealth]);\n  const actSubtitle = \"Act IV – The Polluted Well\";\n  const topStoryText = \"At the heart of the Network Realm, the public wells boil with corrupted light. Lagdrakul rises from the poisoned code, its voice tangled with Ailithm’s logic. You can’t out-damage this dragon — you have to outlast its lagstorm while the rewrite claws through the realm’s veins.\";\n  const phaseHintText = health => {\n    if (health > 75) {\n      return \"The code still follows patterns: predictable rain and crossing streams — echoes of every warning you ignored on the Digital Trail.\";\n    } else if (health > 50) {\n      return \"Shadow helms splinter and reform in the dark, testing whether you’ve really learned to read imitation from intent.\";\n    } else if (health > 25) {\n      return \"The wells pulse red. Phisher nets and glitching lasers comb the frame, leaving only thin, gasping pockets of safe space.\";\n    }\n    return \"The realm’s heartbeat stutters. Lagdrakul’s full lagstorm is here: column-wide freezes, rising packets, and a voice whispering that it would be easier if everything just…stopped.\";\n  };\n  const isStageTwoActive = stageRef.current === 2;\n  const shieldActiveForUI = performance.now() < shieldInvulnUntilRef.current;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      minHeight: \"100vh\",\n      background: \"radial-gradient(circle at top, #020617 0, #020617 45%, #000 100%)\",\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      padding: \"1.25rem\",\n      color: \"white\",\n      fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n      position: \"relative\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => handleExit(false),\n      style: {\n        position: \"absolute\",\n        top: \"1rem\",\n        right: \"1rem\",\n        background: \"rgba(0,0,0,0.6)\",\n        borderRadius: \"999px\",\n        border: \"1px solid rgba(255,255,255,0.35)\",\n        color: \"white\",\n        padding: \"0.4rem 0.9rem\",\n        cursor: \"pointer\",\n        fontSize: \"0.85rem\",\n        zIndex: 60\n      },\n      children: \"\\u2715 Exit\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 484,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        width: GAME_WIDTH,\n        maxWidth: \"100%\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        gap: \"0.7rem\",\n        alignItems: \"center\",\n        position: \"relative\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        style: {\n          fontSize: \"2rem\",\n          textAlign: \"center\",\n          margin: 0,\n          letterSpacing: \"0.06em\",\n          textShadow: \"0 0 16px rgba(248,250,252,0.7), 0 0 32px rgba(59,130,246,0.6)\"\n        },\n        children: \"Lagdrakul Protocol: Final Convergence\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: \"0.85rem\",\n          opacity: 0.8,\n          fontStyle: \"italic\",\n          marginBottom: \"0.15rem\"\n        },\n        children: actSubtitle\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 526,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          maxWidth: 640,\n          textAlign: \"center\",\n          fontSize: \"0.9rem\",\n          opacity: 0.9,\n          margin: 0\n        },\n        children: topStoryText\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 536,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          maxWidth: 540,\n          textAlign: \"center\",\n          fontSize: \"0.8rem\",\n          opacity: 0.8,\n          margin: 0\n        },\n        children: [\"Survive inside the glyph-bound battle frame through\", \" \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"two escalating phases\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 558,\n          columnNumber: 11\n        }, this), \" until the rewrite completes. Move with \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"WASD / Arrows\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 559,\n          columnNumber: 21\n        }, this), \". There is no attack button here \\u2014 just pattern-reading, panic management, and whatever's left of your courage.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 548,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: \"relative\",\n          width: GAME_WIDTH,\n          height: GAME_HEIGHT,\n          marginTop: \"0.5rem\",\n          borderRadius: \"18px\",\n          border: \"2px solid rgba(148,163,184,0.7)\",\n          background: \"linear-gradient(180deg, rgba(15,23,42,0.98), #020617 70%, #000 100%)\",\n          overflow: \"hidden\",\n          boxShadow: isStageTwoActive ? \"0 0 32px rgba(248,113,113,0.9)\" : \"0 0 28px rgba(0,0,0,0.85)\",\n          transform: isStageTwoActive ? \"translateX(0)\" : \"none\",\n          animation: isStageTwoActive ? \"shakeBox 0.35s infinite\" : \"none\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            top: 20,\n            left: \"50%\",\n            transform: \"translateX(-50%)\",\n            textAlign: \"center\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginBottom: \"0.1rem\"\n            },\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: Lagdrakul2A,\n              alt: \"Lagdrakul\",\n              style: {\n                width: 80,\n                height: 80,\n                objectFit: \"contain\",\n                filter: \"drop-shadow(0 0 18px rgba(248,113,113,0.95))\",\n                animation: \"bossGlow 1.4s ease-in-out infinite alternate\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 594,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 593,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontWeight: 600,\n              letterSpacing: \"0.12em\",\n              fontSize: \"0.8rem\",\n              marginBottom: \"0.25rem\",\n              textTransform: \"uppercase\",\n              animation: \"glitch 0.23s infinite\"\n            },\n            children: \"LAGDRAKUL // AILITHM CORE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 606,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: \"0.7rem\",\n              opacity: 0.7,\n              marginBottom: \"0.3rem\"\n            },\n            children: \"Rewrite Stability (Remaining Corruption)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 618,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              width: 260,\n              height: 10,\n              borderRadius: \"999px\",\n              border: \"1px solid rgba(239,68,68,0.9)\",\n              background: \"rgba(15,23,42,0.9)\",\n              overflow: \"hidden\",\n              boxShadow: \"0 0 10px rgba(239,68,68,0.6)\"\n            },\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                width: `${bossHealth}%`,\n                height: \"100%\",\n                background: \"linear-gradient(90deg,#f97316,#ef4444,#b91c1c)\",\n                transition: \"width 90ms linear\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 638,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 627,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 584,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            top: 80,\n            left: \"50%\",\n            transform: \"translateX(-50%)\",\n            fontSize: \"0.75rem\",\n            opacity: 0.8,\n            maxWidth: 380,\n            textAlign: \"center\"\n          },\n          children: phaseHintText(bossHealth)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 651,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            top: 26,\n            right: 26,\n            fontSize: \"0.8rem\",\n            padding: \"0.25rem 0.6rem\",\n            borderRadius: \"999px\",\n            background: \"rgba(15,23,42,0.85)\",\n            border: \"1px solid rgba(148,163,184,0.7)\",\n            boxShadow: \"0 0 10px rgba(15,23,42,0.9)\",\n            display: \"flex\",\n            alignItems: \"center\",\n            gap: \"0.35rem\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"Hits Taken: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n              children: hitsTaken\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 684,\n              columnNumber: 27\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 683,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              padding: \"0.1rem 0.4rem\",\n              borderRadius: \"999px\",\n              fontSize: \"0.7rem\",\n              border: shieldActiveForUI ? \"1px solid rgba(45,212,191,0.9)\" : \"1px solid rgba(148,163,184,0.4)\",\n              background: shieldActiveForUI ? \"linear-gradient(135deg,rgba(45,212,191,0.25),rgba(8,47,73,0.85))\" : \"rgba(15,23,42,0.9)\",\n              textTransform: \"uppercase\",\n              letterSpacing: \"0.06em\"\n            },\n            children: [\"Shield \", shieldActiveForUI ? \"ONLINE\" : \"ready\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 686,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 667,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            left: BATTLE_BOX.x,\n            top: BATTLE_BOX.y,\n            width: BATTLE_BOX.width,\n            height: BATTLE_BOX.height,\n            borderRadius: \"10px\",\n            border: \"3px solid #e5e7eb\",\n            boxShadow: isStageTwoActive ? \"0 0 22px rgba(248,113,113,0.7)\" : \"0 0 16px rgba(59,130,246,0.45)\",\n            overflow: \"hidden\",\n            background: isStageTwoActive ? \"radial-gradient(circle at top, #111827 0, #020617 40%, #111827 70%, #000 100%)\" : \"radial-gradient(circle at top, #020617 0, #020617 60%, #000 100%)\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: \"absolute\",\n              inset: 0,\n              backgroundImage: \"linear-gradient(to right, rgba(148,163,184,0.08) 1px, transparent 1px), linear-gradient(to bottom, rgba(148,163,184,0.08) 1px, transparent 1px)\",\n              backgroundSize: \"28px 28px\",\n              opacity: isStageTwoActive ? 0.9 : 0.6\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 725,\n            columnNumber: 13\n          }, this), isStageTwoActive && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: \"absolute\",\n              inset: 0,\n              background: \"radial-gradient(circle at center, rgba(248,113,113,0.12), transparent 60%)\",\n              mixBlendMode: \"screen\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 738,\n            columnNumber: 15\n          }, this), shields.map(s => /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: \"absolute\",\n              left: s.x - BATTLE_BOX.x - s.radius,\n              top: s.y - BATTLE_BOX.y - s.radius,\n              width: s.radius * 2,\n              height: s.radius * 2,\n              borderRadius: \"999px\",\n              border: \"1px solid rgba(45,212,191,0.9)\",\n              boxShadow: \"0 0 12px rgba(45,212,191,0.9), 0 0 24px rgba(45,212,191,0.6)\",\n              background: \"radial-gradient(circle at 30% 20%, rgba(125,211,252,0.8), rgba(15,23,42,0.95))\",\n              opacity: 0.95\n            }\n          }, s.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 751,\n            columnNumber: 15\n          }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: \"absolute\",\n              left: playerPos.x - BATTLE_BOX.x,\n              top: playerPos.y - BATTLE_BOX.y,\n              width: PLAYER_SIZE,\n              height: PLAYER_SIZE,\n              borderRadius: \"6px\",\n              background: shieldActiveForUI ? \"radial-gradient(circle at 30% 20%, #22c55e, #15803d)\" : \"radial-gradient(circle at 30% 20%, #f97373, #b91c1c)\",\n              boxShadow: shieldActiveForUI ? \"0 0 20px rgba(34,197,94,0.95)\" : \"0 0 16px rgba(248,113,113,0.85)\",\n              border: \"1px solid rgba(248,250,252,0.85)\",\n              transformOrigin: \"center\",\n              transform: shieldActiveForUI ? \"scale(1.1)\" : \"scale(1)\",\n              transition: \"transform 80ms\"\n            },\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontSize: \"0.7rem\",\n                textAlign: \"center\",\n                lineHeight: `${PLAYER_SIZE}px`,\n                textShadow: \"0 0 8px rgba(248,113,113,0.9)\"\n              },\n              children: \"\\u2764\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 791,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 771,\n            columnNumber: 13\n          }, this), bossBullets.map(b => /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: \"absolute\",\n              left: b.x - BATTLE_BOX.x,\n              top: b.y - BATTLE_BOX.y,\n              width: b.width,\n              height: b.height,\n              borderRadius: b.height > 32 ? 4 : 999,\n              background: b.isWarning ? \"linear-gradient(180deg, rgba(56,189,248,0.35), rgba(8,47,73,0.15))\" : b.isLaser ? \"linear-gradient(180deg,#22d3ee,#0ea5e9)\" : \"linear-gradient(180deg,#e5e7eb,#9ca3af)\",\n              boxShadow: b.isWarning ? \"0 0 16px rgba(56,189,248,0.55)\" : b.isLaser ? \"0 0 22px rgba(56,189,248,0.9)\" : \"0 0 10px rgba(156,163,175,0.7)\",\n              opacity: b.isWarning ? 0.88 : 1\n            }\n          }, b.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 805,\n            columnNumber: 15\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 706,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            bottom: 22,\n            left: \"50%\",\n            transform: \"translateX(-50%)\",\n            display: \"flex\",\n            gap: \"0.25rem\",\n            alignItems: \"center\",\n            fontSize: \"1rem\"\n          },\n          children: [Array.from({\n            length: 20\n          }).map((_, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              width: 22,\n              height: 22,\n              borderRadius: \"999px\",\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              background: \"radial-gradient(circle at 30% 20%, #fb7185, #b91c1c)\",\n              boxShadow: \"0 0 10px rgba(252,165,165,0.9)\",\n              border: \"1px solid rgba(254,226,226,0.9)\",\n              fontSize: \"0.85rem\"\n            },\n            children: \"\\u2665\"\n          }, i, false, {\n            fileName: _jsxFileName,\n            lineNumber: 844,\n            columnNumber: 15\n          }, this)), /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              marginLeft: 6,\n              fontSize: \"0.85rem\",\n              opacity: 0.75\n            },\n            children: \"(Damage tally only)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 863,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 831,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            bottom: 18,\n            left: 26,\n            fontSize: \"0.75rem\",\n            opacity: 0.8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: \"Move: WASD / Arrow Keys\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 884,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: \"Goal: Survive both phases of the lagstorm.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 885,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 875,\n          columnNumber: 11\n        }, this), gameState === \"intro\" && /*#__PURE__*/_jsxDEV(IntroOverlay, {\n          onStart: startFightStage1\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 889,\n          columnNumber: 37\n        }, this), gameState === \"midbreak\" && /*#__PURE__*/_jsxDEV(MidBreakOverlay, {\n          onContinue: startFightStage2\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 892,\n          columnNumber: 13\n        }, this), gameState === \"win\" && /*#__PURE__*/_jsxDEV(QuestOverlay, {\n          title: \"\\uD83D\\uDEE1 Rewrite Complete: Ailithm Unbound\",\n          bodyLines: [\"You endure both movements of the lagstorm — the testing patterns and the full frozen roar. Each second you survive is a line of code seared into Lagdrakul’s core.\", \"In the final shudder of the well, the dragon’s voice flickers: first pure Ailithm, then pure Lagdrakul, then something that refuses to be only one. You don’t erase them. You rewrite them.\", \"In this branch of the timeline, protection isn’t total control or total chaos. It’s you, standing in the middle, refusing to let fear or apathy decide how the realm connects.\"],\n          primaryLabel: \"Replay Final Convergence\",\n          onPrimary: handleReplay,\n          secondaryLabel: \"Return to Cyber Map\"\n          // SUCCESS exit: mark completion so dashboard can show story + PNGs\n          ,\n          onSecondary: () => handleExit(true)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 896,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 565,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 503,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"style\", {\n      children: `\n        @keyframes bossGlow {\n          0% {\n            text-shadow: 0 0 10px rgba(248,250,252,0.8), 0 0 24px rgba(59,130,246,0.7);\n            transform: translateY(0);\n          }\n          100% {\n            text-shadow: 0 0 20px rgba(248,113,113,1), 0 0 36px rgba(248,113,113,0.9);\n            transform: translateY(-2px);\n          }\n        }\n\n        @keyframes shakeBox {\n          0%   { transform: translateX(0px); }\n          25%  { transform: translateX(-2px); }\n          50%  { transform: translateX(2px); }\n          75%  { transform: translateX(-1px); }\n          100% { transform: translateX(0px); }\n        }\n\n        @keyframes glitch {\n          0% { transform: translate(0, 0); opacity: 0.9; }\n          20% { transform: translate(-1px, 0); opacity: 1; }\n          40% { transform: translate(1px, 0); opacity: 0.85; }\n          60% { transform: translate(-0.5px, 0); opacity: 1; }\n          80% { transform: translate(0.5px, 0); opacity: 0.9; }\n          100% { transform: translate(0, 0); opacity: 1; }\n        }\n      `\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 914,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 468,\n    columnNumber: 5\n  }, this);\n}\n\n// Attack patterns: two stages, rising difficulty, with randomized pattern selection\n_s(BossFight, \"6Mgje+/A6Uvjvfdh08dQUGWDwPM=\", false, function () {\n  return [useNavigate];\n});\n_c = BossFight;\nfunction spawnAttack(stage, stageT, setBossBullets, safeZone) {\n  const now = performance.now();\n\n  // Helper to conditionally push bullets respecting the hidden safe zone\n  const pushIfSafe = (arr, bullet) => {\n    if (!bulletInSafeZone({\n      x: bullet.x,\n      y: bullet.y,\n      width: bullet.width,\n      height: bullet.height\n    }, safeZone)) {\n      arr.push(bullet);\n    }\n  };\n  if (stage === 1) {\n    // Stage 1: readable patterns, moderate speed, but varied\n    const candidates = [];\n    if (stageT < 0.33) {\n      candidates.push(\"rain\", \"burst\");\n    } else if (stageT < 0.66) {\n      candidates.push(\"rain\", \"burst\", \"diagonals\");\n    } else {\n      candidates.push(\"burst\", \"diagonals\", \"bars\");\n    }\n    let pattern = candidates[Math.floor(Math.random() * candidates.length)];\n    if (candidates.length > 1 && pattern === lastStage1Pattern) {\n      const idx = candidates.indexOf(pattern);\n      pattern = candidates[(idx + 1) % candidates.length];\n    }\n    lastStage1Pattern = pattern;\n    if (pattern === \"rain\") {\n      // Pattern A: vertical \"code rain\" from top, with brief warning beams\n      const columns = 6;\n      const warnings = [];\n      const hail = [];\n      for (let i = 0; i < columns; i++) {\n        const colX = BATTLE_BOX.x + (i + 0.5) * (BATTLE_BOX.width / columns) - 4;\n\n        // Warning column\n        const warnBullet = {\n          id: `s1-rain-warn-${now}-${i}`,\n          x: colX,\n          y: BATTLE_BOX.y - 6,\n          vx: 0,\n          vy: 0,\n          width: 8,\n          height: BATTLE_BOX.height + 12,\n          lifeMs: 260,\n          bornAt: now,\n          isWarning: true\n        };\n        pushIfSafe(warnings, warnBullet);\n\n        // Actual falling packet\n        const hailBullet = {\n          id: `s1-rain-${now}-${i}`,\n          x: colX,\n          y: BATTLE_BOX.y - 14,\n          vx: 0,\n          vy: 3.0,\n          width: 8,\n          height: 16\n        };\n        pushIfSafe(hail, hailBullet);\n      }\n      if (warnings.length > 0) {\n        setBossBullets(prev => [...prev, ...warnings]);\n      }\n      if (hail.length > 0) {\n        setTimeout(() => {\n          setBossBullets(prev => [...prev, ...hail]);\n        }, 260);\n      }\n      return;\n    } else if (pattern === \"burst\") {\n      // Radial burst from center\n      const centerX = BATTLE_BOX.x + BATTLE_BOX.width / 2;\n      const centerY = BATTLE_BOX.y + BATTLE_BOX.height / 2;\n      const bulletsPerRing = 10;\n      const speed = 2.8;\n      const bullets = [];\n      for (let i = 0; i < bulletsPerRing; i++) {\n        const angle = Math.PI * 2 / bulletsPerRing * i;\n        const b = {\n          id: `s1-burst-${now}-${i}`,\n          x: centerX - 5,\n          y: centerY - 5,\n          vx: Math.cos(angle) * speed,\n          vy: Math.sin(angle) * speed,\n          width: 10,\n          height: 10\n        };\n        pushIfSafe(bullets, b);\n      }\n      if (bullets.length > 0) {\n        setBossBullets(prev => [...prev, ...bullets]);\n      }\n      return;\n    } else if (pattern === \"diagonals\") {\n      // Crossing diagonals from sides\n      const rows = 4;\n      const bullets = [];\n      for (let r = 0; r < rows; r++) {\n        const rowY = BATTLE_BOX.y + (r + 0.5) * (BATTLE_BOX.height / rows);\n        const left = {\n          id: `s1-diagL-${now}-${r}`,\n          x: BATTLE_BOX.x - 14,\n          y: rowY,\n          vx: 3.1,\n          vy: (r % 2 === 0 ? 1 : -1) * 1.3,\n          width: 10,\n          height: 16\n        };\n        pushIfSafe(bullets, left);\n        const right = {\n          id: `s1-diagR-${now}-${r}`,\n          x: BATTLE_BOX.x + BATTLE_BOX.width + 4,\n          y: rowY,\n          vx: -3.1,\n          vy: (r % 2 === 0 ? -1 : 1) * 1.3,\n          width: 10,\n          height: 16\n        };\n        pushIfSafe(bullets, right);\n      }\n      if (bullets.length > 0) {\n        setBossBullets(prev => [...prev, ...bullets]);\n      }\n      return;\n    } else if (pattern === \"bars\") {\n      // Sweeping bars with a clear gap and subtle row warnings\n      const rows = 3;\n      const warnings = [];\n      const bars = [];\n      for (let r = 0; r < rows; r++) {\n        const barHeight = 10;\n        const y = BATTLE_BOX.y + (r + 0.5) * (BATTLE_BOX.height / rows) - barHeight / 2;\n\n        // Row warning band\n        const warn = {\n          id: `s1-bar-warn-${now}-${r}`,\n          x: BATTLE_BOX.x,\n          y: y - 4,\n          vx: 0,\n          vy: 0,\n          width: BATTLE_BOX.width,\n          height: barHeight + 8,\n          lifeMs: 260,\n          bornAt: now,\n          isWarning: true\n        };\n        pushIfSafe(warnings, warn);\n        const segments = 5;\n        const gapIndex = Math.floor(Math.random() * segments);\n        for (let s = 0; s < segments; s++) {\n          if (s === gapIndex) continue;\n          const segWidth = BATTLE_BOX.width / segments;\n          const x = BATTLE_BOX.x - segWidth + s * segWidth;\n          const bar = {\n            id: `s1-bar-${now}-${r}-${s}`,\n            x,\n            y,\n            vx: 3.3,\n            vy: 0,\n            width: segWidth * 1.3,\n            height: barHeight\n          };\n          pushIfSafe(bars, bar);\n        }\n      }\n      if (warnings.length > 0) {\n        setBossBullets(prev => [...prev, ...warnings]);\n      }\n      if (bars.length > 0) {\n        setTimeout(() => {\n          setBossBullets(prev => [...prev, ...bars]);\n        }, 260);\n      }\n      return;\n    }\n    return;\n  }\n\n  // Stage 2: denser, scarier, lasers & packets combined (with varied patterns)\n  const candidates = [];\n  if (stageT < 0.35) {\n    candidates.push(\"rise\", \"netsLasers\");\n  } else if (stageT < 0.7) {\n    candidates.push(\"rise\", \"netsLasers\", \"fullStorm\");\n  } else {\n    candidates.push(\"netsLasers\", \"fullStorm\");\n  }\n  let pattern = candidates[Math.floor(Math.random() * candidates.length)];\n  if (candidates.length > 1 && pattern === lastStage2Pattern) {\n    const idx = candidates.indexOf(pattern);\n    pattern = candidates[(idx + 1) % candidates.length];\n  }\n  lastStage2Pattern = pattern;\n  if (pattern === \"rise\") {\n    // Pattern D: rising packets from bottom with minor horizontal drift + warnings\n    const columns = 5;\n    const linePattern = [1, 2, 3, 2, 1];\n    const warnings = [];\n    const bullets = [];\n    for (let c = 0; c < columns; c++) {\n      const count = linePattern[c];\n      const colX = BATTLE_BOX.x + (c + 0.5) * (BATTLE_BOX.width / columns) - 5;\n      const warn = {\n        id: `s2-rise-warn-${now}-${c}`,\n        x: colX - 5,\n        y: BATTLE_BOX.y + BATTLE_BOX.height - 4,\n        vx: 0,\n        vy: 0,\n        width: 20,\n        height: 20,\n        lifeMs: 260,\n        bornAt: now,\n        isWarning: true\n      };\n      pushIfSafe(warnings, warn);\n      for (let i = 0; i < count; i++) {\n        const b = {\n          id: `s2-rise-${now}-${c}-${i}`,\n          x: colX,\n          y: BATTLE_BOX.y + BATTLE_BOX.height + 20 + i * 18,\n          vx: (Math.random() - 0.5) * 0.6,\n          vy: -3.7,\n          width: 10,\n          height: 18\n        };\n        pushIfSafe(bullets, b);\n      }\n    }\n    if (warnings.length > 0) {\n      setBossBullets(prev => [...prev, ...warnings]);\n    }\n    if (bullets.length > 0) {\n      setTimeout(() => {\n        setBossBullets(prev => [...prev, ...bullets]);\n      }, 260);\n    }\n  } else if (pattern === \"netsLasers\") {\n    // Pattern E: alternating nets + short lasers (with warnings, no forced safe corner)\n    const rows = 3;\n    const nets = [];\n\n    // Nets first (horizontal bars)\n    for (let r = 0; r < rows; r++) {\n      const barHeight = 10;\n      const y = BATTLE_BOX.y + (r + 0.5) * (BATTLE_BOX.height / rows) - barHeight / 2;\n      const segments = 6;\n      const gapIndex = Math.floor(Math.random() * segments);\n      for (let s = 0; s < segments; s++) {\n        if (s === gapIndex) continue;\n        const segWidth = BATTLE_BOX.width / segments;\n        const x = BATTLE_BOX.x - segWidth + s * segWidth;\n        const bar = {\n          id: `s2-net-${now}-${r}-${s}`,\n          x,\n          y,\n          vx: 3.7,\n          vy: 0,\n          width: segWidth * 1.25,\n          height: barHeight\n        };\n        pushIfSafe(nets, bar);\n      }\n    }\n    if (nets.length > 0) {\n      setBossBullets(prev => [...prev, ...nets]);\n    }\n\n    // Lasers with warnings; randomly vertical OR horizontal\n    const warningBullets = [];\n    const laserBullets = [];\n    const orientation = Math.random() < 0.5 ? \"vertical\" : \"horizontal\";\n    if (orientation === \"vertical\") {\n      const columns = 4;\n      for (let c = 0; c < columns; c++) {\n        if (Math.random() < 0.4) continue; // randomness\n\n        const colX = BATTLE_BOX.x + c * (BATTLE_BOX.width / columns) + 4;\n\n        // Warning indicator (brief teal column)\n        const warn = {\n          id: `s2-warning-v-${now}-${c}`,\n          x: colX,\n          y: BATTLE_BOX.y,\n          vx: 0,\n          vy: 0,\n          width: BATTLE_BOX.width / columns - 8,\n          height: BATTLE_BOX.height,\n          lifeMs: 350,\n          bornAt: now,\n          isWarning: true,\n          isLaser: true\n        };\n        pushIfSafe(warningBullets, warn);\n\n        // Actual vertical laser\n        const laser = {\n          id: `s2-laser-v-${now}-${c}`,\n          x: colX,\n          y: BATTLE_BOX.y,\n          vx: 0,\n          vy: 0,\n          width: BATTLE_BOX.width / columns - 8,\n          height: BATTLE_BOX.height,\n          lifeMs: 650,\n          bornAt: now + 350,\n          isLaser: true\n        };\n        pushIfSafe(laserBullets, laser);\n      }\n    } else {\n      // Horizontal lasers across rows\n      const rowsLaser = 4;\n      for (let r = 0; r < rowsLaser; r++) {\n        if (Math.random() < 0.4) continue;\n        const rowHeight = BATTLE_BOX.height / rowsLaser - 8;\n        const rowY = BATTLE_BOX.y + r * (BATTLE_BOX.height / rowsLaser) + 4;\n\n        // Warning indicator (horizontal stripe)\n        const warn = {\n          id: `s2-warning-h-${now}-${r}`,\n          x: BATTLE_BOX.x,\n          y: rowY,\n          vx: 0,\n          vy: 0,\n          width: BATTLE_BOX.width,\n          height: rowHeight,\n          lifeMs: 350,\n          bornAt: now,\n          isWarning: true,\n          isLaser: true\n        };\n        pushIfSafe(warningBullets, warn);\n\n        // Actual horizontal laser\n        const laser = {\n          id: `s2-laser-h-${now}-${r}`,\n          x: BATTLE_BOX.x,\n          y: rowY,\n          vx: 0,\n          vy: 0,\n          width: BATTLE_BOX.width,\n          height: rowHeight,\n          lifeMs: 650,\n          bornAt: now + 350,\n          isLaser: true\n        };\n        pushIfSafe(laserBullets, laser);\n      }\n    }\n    if (warningBullets.length > 0) {\n      setBossBullets(prev => [...prev, ...warningBullets]);\n      setTimeout(() => {\n        setBossBullets(prev => [...prev, ...laserBullets.map(b => ({\n          ...b,\n          bornAt: performance.now()\n        }))]);\n      }, 350);\n    }\n  } else if (pattern === \"fullStorm\") {\n    // Pattern F: full lagstorm – rising + crashing + heavy lasers\n    const columns = 5;\n    const linePattern = [1, 2, 3, 2, 1];\n    const rising = [];\n    const falling = [];\n\n    // Rising from bottom\n    for (let c = 0; c < columns; c++) {\n      const count = linePattern[c];\n      const colX = BATTLE_BOX.x + (c + 0.5) * (BATTLE_BOX.width / columns) - 5;\n      for (let i = 0; i < count; i++) {\n        const b = {\n          id: `s2-riseF-${now}-${c}-${i}`,\n          x: colX,\n          y: BATTLE_BOX.y + BATTLE_BOX.height + 22 + i * 16,\n          vx: 0,\n          vy: -4.0,\n          width: 10,\n          height: 18\n        };\n        pushIfSafe(rising, b);\n      }\n    }\n\n    // Crashing from top\n    for (let c = 0; c < columns; c++) {\n      const count = linePattern[c];\n      const colX = BATTLE_BOX.x + (c + 0.5) * (BATTLE_BOX.width / columns) - 5;\n      for (let i = 0; i < count; i++) {\n        const b = {\n          id: `s2-topF-${now}-${c}-${i}`,\n          x: colX,\n          y: BATTLE_BOX.y - 24 - i * 16,\n          vx: 0,\n          vy: 3.9,\n          width: 10,\n          height: 18\n        };\n        pushIfSafe(falling, b);\n      }\n    }\n    if (rising.length > 0 || falling.length > 0) {\n      setBossBullets(prev => [...prev, ...rising, ...falling]);\n    }\n\n    // Heavy lasers with warnings; vertical OR horizontal, no guaranteed safe corner\n    const warningBullets = [];\n    const laserBullets = [];\n    const orientation = Math.random() < 0.5 ? \"vertical\" : \"horizontal\";\n    if (orientation === \"vertical\") {\n      for (let c = 0; c < columns; c++) {\n        if (Math.random() < 0.3) continue;\n        const colX = BATTLE_BOX.x + c * (BATTLE_BOX.width / columns) + 4;\n        const warn = {\n          id: `s2-warningF-v-${now}-${c}`,\n          x: colX,\n          y: BATTLE_BOX.y,\n          vx: 0,\n          vy: 0,\n          width: BATTLE_BOX.width / columns - 8,\n          height: BATTLE_BOX.height,\n          lifeMs: 350,\n          bornAt: now,\n          isWarning: true,\n          isLaser: true\n        };\n        pushIfSafe(warningBullets, warn);\n        const laser = {\n          id: `s2-laserF-v-${now}-${c}`,\n          x: colX,\n          y: BATTLE_BOX.y,\n          vx: 0,\n          vy: 0,\n          width: BATTLE_BOX.width / columns - 8,\n          height: BATTLE_BOX.height,\n          lifeMs: 800,\n          bornAt: now + 350,\n          isLaser: true\n        };\n        pushIfSafe(laserBullets, laser);\n      }\n    } else {\n      const rowsLaser = 5;\n      for (let r = 0; r < rowsLaser; r++) {\n        if (Math.random() < 0.3) continue;\n        const rowHeight = BATTLE_BOX.height / rowsLaser - 8;\n        const rowY = BATTLE_BOX.y + r * (BATTLE_BOX.height / rowsLaser) + 4;\n        const warn = {\n          id: `s2-warningF-h-${now}-${r}`,\n          x: BATTLE_BOX.x,\n          y: rowY,\n          vx: 0,\n          vy: 0,\n          width: BATTLE_BOX.width,\n          height: rowHeight,\n          lifeMs: 350,\n          bornAt: now,\n          isWarning: true,\n          isLaser: true\n        };\n        pushIfSafe(warningBullets, warn);\n        const laser = {\n          id: `s2-laserF-h-${now}-${r}`,\n          x: BATTLE_BOX.x,\n          y: rowY,\n          vx: 0,\n          vy: 0,\n          width: BATTLE_BOX.width,\n          height: rowHeight,\n          lifeMs: 800,\n          bornAt: now + 350,\n          isLaser: true\n        };\n        pushIfSafe(laserBullets, laser);\n      }\n    }\n    if (warningBullets.length > 0) {\n      setBossBullets(prev => [...prev, ...warningBullets]);\n      setTimeout(() => {\n        setBossBullets(prev => [...prev, ...laserBullets.map(b => ({\n          ...b,\n          bornAt: performance.now()\n        }))]);\n      }, 350);\n    }\n  }\n}\n\n// Reusable overlays\nfunction QuestOverlay({\n  title,\n  bodyLines,\n  primaryLabel,\n  onPrimary,\n  secondaryLabel,\n  onSecondary\n}) {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: \"absolute\",\n      inset: 0,\n      background: \"rgba(15,23,42,0.94)\",\n      backdropFilter: \"blur(3px)\",\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      padding: \"1.5rem\",\n      textAlign: \"center\",\n      zIndex: 50\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        maxWidth: 520,\n        display: \"flex\",\n        flexDirection: \"column\",\n        gap: \"0.85rem\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          fontSize: \"1.9rem\",\n          margin: 0\n        },\n        children: title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1555,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: \"0.95rem\",\n          color: \"rgba(226,232,240,0.96)\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          gap: \"0.4rem\"\n        },\n        children: bodyLines.map((line, idx) => /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            margin: 0\n          },\n          children: line\n        }, idx, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1573,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1563,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: \"flex\",\n          gap: \"0.75rem\",\n          justifyContent: \"center\",\n          flexWrap: \"wrap\",\n          marginTop: \"0.2rem\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onPrimary,\n          style: {\n            padding: \"0.7rem 1.5rem\",\n            borderRadius: \"999px\",\n            border: \"none\",\n            background: \"linear-gradient(135deg,#22c55e,#16a34a)\",\n            color: \"white\",\n            fontWeight: 600,\n            cursor: \"pointer\",\n            minWidth: 170,\n            boxShadow: \"0 8px 18px rgba(34,197,94,0.4)\"\n          },\n          children: primaryLabel\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1587,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onSecondary,\n          style: {\n            padding: \"0.7rem 1.5rem\",\n            borderRadius: \"999px\",\n            border: \"1px solid rgba(148,163,184,0.85)\",\n            background: \"rgba(15,23,42,0.96)\",\n            color: \"white\",\n            cursor: \"pointer\",\n            minWidth: 170\n          },\n          children: secondaryLabel\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1603,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1578,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1547,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1533,\n    columnNumber: 5\n  }, this);\n}\n_c2 = QuestOverlay;\nfunction IntroOverlay({\n  onStart\n}) {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: \"absolute\",\n      inset: 0,\n      background: \"rgba(15,23,42,0.95)\",\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      padding: \"1.5rem\",\n      textAlign: \"center\",\n      zIndex: 40\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        maxWidth: 520,\n        display: \"flex\",\n        flexDirection: \"column\",\n        gap: \"0.8rem\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          fontSize: \"1.8rem\",\n          margin: 0\n        },\n        children: \"Final Trial: The Polluted Well\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1646,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          fontSize: \"0.95rem\",\n          color: \"rgba(226,232,240,0.96)\",\n          margin: 0\n        },\n        children: \"Lagdrakul and Ailithm's merged code has rooted itself in the realm\\u2019s most trusted wells \\u2014 the places everyone assumes are safe. In this space, there is no \\\"mute all threats\\\" button. Only patterns, panic, and the way your hands remember how to move.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1654,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          fontSize: \"0.85rem\",\n          color: \"rgba(148,163,184,0.96)\",\n          margin: 0\n        },\n        children: \"You'll face two movements of the same song: a readable rhythm, then a full lagstorm. Survive both.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1666,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onStart,\n        style: {\n          marginTop: \"0.6rem\",\n          padding: \"0.65rem 1.6rem\",\n          borderRadius: \"999px\",\n          border: \"none\",\n          background: \"linear-gradient(135deg,#3b82f6,#0ea5e9)\",\n          color: \"white\",\n          fontWeight: 600,\n          cursor: \"pointer\",\n          alignSelf: \"center\",\n          minWidth: 220,\n          boxShadow: \"0 8px 18px rgba(37,99,235,0.5)\"\n        },\n        children: \"Begin Final Convergence (Enter)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1676,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1638,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1625,\n    columnNumber: 5\n  }, this);\n}\n\n// Midbreak: dialogue overlay, press any key to continue\n_c3 = IntroOverlay;\nfunction MidBreakOverlay({\n  onContinue\n}) {\n  const handleClick = () => {\n    onContinue();\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    onClick: handleClick,\n    style: {\n      position: \"absolute\",\n      inset: 0,\n      background: \"rgba(15,23,42,0.96)\",\n      backdropFilter: \"blur(3px)\",\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      padding: \"1.5rem\",\n      textAlign: \"center\",\n      zIndex: 45,\n      cursor: \"pointer\"\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        maxWidth: 540,\n        display: \"flex\",\n        flexDirection: \"column\",\n        gap: \"0.85rem\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          fontSize: \"1.7rem\",\n          margin: 0\n        },\n        children: \"\\\"You're learning.\\\"\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1730,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          fontSize: \"0.95rem\",\n          color: \"rgba(226,232,240,0.96)\",\n          margin: 0\n        },\n        children: \"The storm pauses for a heartbeat. Glyphs hang mid-air, frozen like raindrops in a flash of lightning. In the stillness, Lagdrakul speaks \\u2014 except the cadence is unmistakably Ailithm's.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1738,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          fontSize: \"0.9rem\",\n          color: \"rgba(248,250,252,0.96)\",\n          margin: 0,\n          fontStyle: \"italic\"\n        },\n        children: \"\\\"You adapt. You predict. Do you feel it? How quiet it could be if nothing ever changed again? If every pattern stayed exactly the same, forever?\\\"\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1749,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          fontSize: \"0.85rem\",\n          color: \"rgba(148,163,184,0.96)\",\n          margin: 0\n        },\n        children: \"The wells wait. The code waits. Phase II is where you decide whether safety means freezing the realm, or standing in the lag and letting it move anyway.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1761,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          fontSize: \"0.8rem\",\n          color: \"rgba(209,213,219,0.96)\",\n          marginTop: \"0.4rem\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Press any key or click\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1779,\n          columnNumber: 11\n        }, this), \" to step into the lagstorm.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1772,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1722,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1706,\n    columnNumber: 5\n  }, this);\n}\n_c4 = MidBreakOverlay;\nexport default BossFight;\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"BossFight\");\n$RefreshReg$(_c2, \"QuestOverlay\");\n$RefreshReg$(_c3, \"IntroOverlay\");\n$RefreshReg$(_c4, \"MidBreakOverlay\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","Lagdrakul2A","jsxDEV","_jsxDEV","GAME_WIDTH","GAME_HEIGHT","BATTLE_BOX","x","y","width","height","PLAYER_SIZE","PLAYER_SPEED","STAGE_ONE_DURATION","STAGE_TWO_DURATION","DASHBOARD_ROUTE","GAME_NUM_FOR_STORY","clamp","value","min","max","Math","lastStage1Pattern","lastStage2Pattern","bulletInSafeZone","bullet","safeZone","_bullet$width","_bullet$height","bx2","by2","sx1","sy1","sx2","sy2","BossFight","_s","navigate","gameState","setGameState","playerPos","setPlayerPos","bossHealth","setBossHealth","bossBullets","setBossBullets","hitsTaken","setHitsTaken","shields","setShields","shieldsRef","shieldInvulnUntilRef","lastShieldSpawnRef","safeZoneRef","keysRef","playerPosRef","lastAttackRef","stageStartRef","stageRef","current","spawnShield","margin","radius","random","shield","id","performance","now","next","handleKeyDown","e","isArrow","key","preventDefault","includes","startFightStage2","startFightStage1","handleKeyUp","window","addEventListener","removeEventListener","resetPlayerPosition","base","resetShieldsAndSafeZone","zoneWidth","zoneHeight","handleReplay","handleExit","isSuccessful","localStorage","setItem","String","animationId","lastFrame","loop","time","dt","prev","nx","ny","k","nextPos","stage","stageDuration","elapsed","stageT","cancelAnimationFrame","newHealth","ratio","round","shieldInterval","length","player","pxCenter","pyCenter","changed","remaining","s","dx","dy","distSq","r","push","attackInterval","extraPause","effectiveInterval","spawnAttack","updated","tookHit","px1","py1","px2","py2","clock","shieldInvulnActive","shieldsChanged","shieldArr","b","vx","vy","lifeMs","bornAt","bx1","by1","isLaser","isWarning","remainingShields","shieldHit","collide","h","requestAnimationFrame","actSubtitle","topStoryText","phaseHintText","health","isStageTwoActive","shieldActiveForUI","style","minHeight","background","display","alignItems","justifyContent","padding","color","fontFamily","position","children","onClick","top","right","borderRadius","border","cursor","fontSize","zIndex","fileName","_jsxFileName","lineNumber","columnNumber","maxWidth","flexDirection","gap","textAlign","letterSpacing","textShadow","opacity","fontStyle","marginBottom","marginTop","overflow","boxShadow","transform","animation","left","src","alt","objectFit","filter","fontWeight","textTransform","transition","inset","backgroundImage","backgroundSize","mixBlendMode","map","transformOrigin","lineHeight","bottom","Array","from","_","i","marginLeft","IntroOverlay","onStart","MidBreakOverlay","onContinue","QuestOverlay","title","bodyLines","primaryLabel","onPrimary","secondaryLabel","onSecondary","_c","pushIfSafe","arr","candidates","pattern","floor","idx","indexOf","columns","warnings","hail","colX","warnBullet","hailBullet","setTimeout","centerX","centerY","bulletsPerRing","speed","bullets","angle","PI","cos","sin","rows","rowY","bars","barHeight","warn","segments","gapIndex","segWidth","bar","linePattern","c","count","nets","warningBullets","laserBullets","orientation","laser","rowsLaser","rowHeight","rising","falling","backdropFilter","line","flexWrap","minWidth","_c2","alignSelf","_c3","handleClick","_c4","$RefreshReg$"],"sources":["C:/Users/frenz/OneDrive/Desktop/CyberSlayers/frontend/src/pages/PasswordGame.jsx"],"sourcesContent":["// BossFight.jsx\r\nimport React, { useState, useEffect, useRef } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport Lagdrakul2A from \"../assets/Lagdrakul2A.png\";\r\n\r\nconst GAME_WIDTH = 800;\r\nconst GAME_HEIGHT = 550;\r\n\r\nconst BATTLE_BOX = {\r\n  x: 250,\r\n  y: 180,\r\n  width: 300,\r\n  height: 260,\r\n};\r\n\r\nconst PLAYER_SIZE = 18;\r\nconst PLAYER_SPEED = 5;\r\n\r\nconst STAGE_ONE_DURATION = 20000; \r\nconst STAGE_TWO_DURATION = 25000; \r\nconst DASHBOARD_ROUTE = \"/dashboard\";\r\n\r\n// This boss fight is thematically Act IV – The Polluted Well (Module 4).\r\n// If you hook it to a different node on the map, update this number.\r\nconst GAME_NUM_FOR_STORY = 6;\r\n\r\nfunction clamp(value, min, max) {\r\n  return Math.max(min, Math.min(max, value));\r\n}\r\n\r\n// Remember last chosen pattern per stage so we don't spam the same one\r\nlet lastStage1Pattern = null;\r\nlet lastStage2Pattern = null;\r\n\r\n// Helper: apply hidden safe zone filter\r\nfunction bulletInSafeZone(bullet, safeZone) {\r\n  if (!safeZone) return false;\r\n  const { x, y, width, height } = bullet;\r\n  const bx2 = x + (bullet.width ?? 0);\r\n  const by2 = y + (bullet.height ?? 0);\r\n  const sx1 = safeZone.x;\r\n  const sy1 = safeZone.y;\r\n  const sx2 = safeZone.x + safeZone.width;\r\n  const sy2 = safeZone.y + safeZone.height;\r\n  return !(bx2 < sx1 || x > sx2 || by2 < sy1 || y > sy2);\r\n}\r\n\r\nfunction BossFight() {\r\n  const navigate = useNavigate();\r\n\r\n  const [gameState, setGameState] = useState(\"intro\");\r\n  const [playerPos, setPlayerPos] = useState({\r\n    x: BATTLE_BOX.x + BATTLE_BOX.width / 2 - PLAYER_SIZE / 2,\r\n    y: BATTLE_BOX.y + BATTLE_BOX.height / 2 - PLAYER_SIZE / 2,\r\n  });\r\n  const [bossHealth, setBossHealth] = useState(100);\r\n  const [bossBullets, setBossBullets] = useState([]);\r\n  const [hitsTaken, setHitsTaken] = useState(0); \r\n\r\n  // Energy shields\r\n  const [shields, setShields] = useState([]);\r\n  const shieldsRef = useRef([]);\r\n  const shieldInvulnUntilRef = useRef(0);\r\n  const lastShieldSpawnRef = useRef(0);\r\n\r\n  // Hidden safe zone (about 1/8th area of battle box, no bullets spawn here)\r\n  const safeZoneRef = useRef(null);\r\n\r\n  const keysRef = useRef({});\r\n  const playerPosRef = useRef(playerPos);\r\n  const lastAttackRef = useRef(0);\r\n  const stageStartRef = useRef(0);\r\n  const stageRef = useRef(1); // 1 or 2\r\n\r\n  // Keep refs updated\r\n  useEffect(() => {\r\n    playerPosRef.current = playerPos;\r\n  }, [playerPos]);\r\n\r\n  // Spawn a shield pickup somewhere inside the battle box\r\n  const spawnShield = () => {\r\n    const margin = 20;\r\n    const radius = 12;\r\n    const x =\r\n      BATTLE_BOX.x +\r\n      margin +\r\n      Math.random() * (BATTLE_BOX.width - 2 * margin);\r\n    const y =\r\n      BATTLE_BOX.y +\r\n      margin +\r\n      Math.random() * (BATTLE_BOX.height - 2 * margin);\r\n\r\n    const shield = {\r\n      id: `shield-${performance.now()}-${Math.random()}`,\r\n      x,\r\n      y,\r\n      radius,\r\n    };\r\n    const next = [...shieldsRef.current, shield];\r\n    shieldsRef.current = next;\r\n    setShields(next);\r\n  };\r\n\r\n  // Keyboard handling (prevent scroll + phase transitions)\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      const isArrow =\r\n        e.key === \"ArrowUp\" ||\r\n        e.key === \"ArrowDown\" ||\r\n        e.key === \"ArrowLeft\" ||\r\n        e.key === \"ArrowRight\";\r\n\r\n      // prevent page from scrolling when using arrows\r\n      if (isArrow) {\r\n        e.preventDefault();\r\n      }\r\n\r\n      // Midbreak → any key continues to Phase II\r\n      if (gameState === \"midbreak\") {\r\n        if (![\"Shift\", \"Meta\", \"Alt\", \"Control\"].includes(e.key)) {\r\n          e.preventDefault();\r\n          startFightStage2();\r\n        }\r\n        return;\r\n      }\r\n\r\n      keysRef.current[e.key] = true;\r\n\r\n      if (gameState === \"intro\" && e.key === \"Enter\") {\r\n        e.preventDefault();\r\n        startFightStage1();\r\n      }\r\n    };\r\n\r\n    const handleKeyUp = (e) => {\r\n      keysRef.current[e.key] = false;\r\n    };\r\n\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    window.addEventListener(\"keyup\", handleKeyUp);\r\n    return () => {\r\n      window.removeEventListener(\"keydown\", handleKeyDown);\r\n      window.removeEventListener(\"keyup\", handleKeyUp);\r\n    };\r\n  }, [gameState]);\r\n\r\n  const resetPlayerPosition = () => {\r\n    const base = {\r\n      x: BATTLE_BOX.x + BATTLE_BOX.width / 2 - PLAYER_SIZE / 2,\r\n      y: BATTLE_BOX.y + BATTLE_BOX.height / 2 - PLAYER_SIZE / 2,\r\n    };\r\n    setPlayerPos(base);\r\n    playerPosRef.current = base;\r\n  };\r\n\r\n  const resetShieldsAndSafeZone = () => {\r\n    shieldsRef.current = [];\r\n    setShields([]);\r\n    shieldInvulnUntilRef.current = 0;\r\n    lastShieldSpawnRef.current = performance.now();\r\n\r\n    // Hidden safe rectangle ≈ 1/8 of the battle box area\r\n    const zoneWidth = BATTLE_BOX.width / 4; // width * height/2 = 1/8 area\r\n    const zoneHeight = BATTLE_BOX.height / 2;\r\n    const x =\r\n      BATTLE_BOX.x +\r\n      Math.random() * (BATTLE_BOX.width - zoneWidth);\r\n    const y =\r\n      BATTLE_BOX.y +\r\n      Math.random() * (BATTLE_BOX.height - zoneHeight);\r\n    safeZoneRef.current = { x, y, width: zoneWidth, height: zoneHeight };\r\n  };\r\n\r\n  const startFightStage1 = () => {\r\n    stageRef.current = 1;\r\n    stageStartRef.current = performance.now();\r\n    lastAttackRef.current = performance.now();\r\n    setBossBullets([]);\r\n    resetPlayerPosition();\r\n    setBossHealth(100);\r\n    setHitsTaken(0); // reset hit tally at start of run\r\n    resetShieldsAndSafeZone();\r\n    setGameState(\"playing\");\r\n  };\r\n\r\n  const startFightStage2 = () => {\r\n    stageRef.current = 2;\r\n    stageStartRef.current = performance.now();\r\n    lastAttackRef.current = performance.now();\r\n    setBossBullets([]);\r\n    resetPlayerPosition();\r\n    resetShieldsAndSafeZone();\r\n    setGameState(\"playing\");\r\n  };\r\n\r\n  const handleReplay = () => {\r\n    startFightStage1();\r\n  };\r\n\r\n  // exit can optionally mark a successful completion for the dashboard story system\r\n  const handleExit = (isSuccessful = false) => {\r\n    if (isSuccessful) {\r\n      try {\r\n        localStorage.setItem(\r\n          \"cyberslayers_last_completed_game\",\r\n          String(GAME_NUM_FOR_STORY)\r\n        );\r\n        localStorage.setItem(\r\n          \"cyberslayers_last_completion_status\",\r\n          \"success\"\r\n        );\r\n      } catch (e) {\r\n        // fail silently; navigation still happens\r\n      }\r\n    }\r\n\r\n    navigate(DASHBOARD_ROUTE);\r\n  };\r\n\r\n  // Main game loop\r\n  useEffect(() => {\r\n    if (gameState !== \"playing\") return;\r\n\r\n    let animationId;\r\n    let lastFrame = performance.now();\r\n\r\n    const loop = (time) => {\r\n      const dt = time - lastFrame;\r\n      lastFrame = time;\r\n\r\n      // Move player\r\n      setPlayerPos((prev) => {\r\n        let nx = prev.x;\r\n        let ny = prev.y;\r\n\r\n        const k = keysRef.current;\r\n        if (k[\"ArrowLeft\"] || k[\"a\"] || k[\"A\"]) {\r\n          nx -= PLAYER_SPEED;\r\n        }\r\n        if (k[\"ArrowRight\"] || k[\"d\"] || k[\"D\"]) {\r\n          nx += PLAYER_SPEED;\r\n        }\r\n        if (k[\"ArrowUp\"] || k[\"w\"] || k[\"W\"]) {\r\n          ny -= PLAYER_SPEED;\r\n        }\r\n        if (k[\"ArrowDown\"] || k[\"s\"] || k[\"S\"]) {\r\n          ny += PLAYER_SPEED;\r\n        }\r\n\r\n        nx = clamp(\r\n          nx,\r\n          BATTLE_BOX.x,\r\n          BATTLE_BOX.x + BATTLE_BOX.width - PLAYER_SIZE\r\n        );\r\n        ny = clamp(\r\n          ny,\r\n          BATTLE_BOX.y,\r\n          BATTLE_BOX.y + BATTLE_BOX.height - PLAYER_SIZE\r\n        );\r\n\r\n        const nextPos = { x: nx, y: ny };\r\n        playerPosRef.current = nextPos;\r\n        return nextPos;\r\n      });\r\n\r\n      const stage = stageRef.current;\r\n      const stageDuration =\r\n        stage === 1 ? STAGE_ONE_DURATION : STAGE_TWO_DURATION;\r\n      const elapsed = performance.now() - stageStartRef.current;\r\n      const stageT = clamp(elapsed / stageDuration, 0, 1);\r\n\r\n      // Stage transitions\r\n      if (stage === 1 && elapsed >= STAGE_ONE_DURATION) {\r\n        setGameState(\"midbreak\");\r\n        cancelAnimationFrame(animationId);\r\n        return;\r\n      }\r\n      if (stage === 2 && elapsed >= STAGE_TWO_DURATION) {\r\n        setGameState(\"win\");\r\n        cancelAnimationFrame(animationId);\r\n        return;\r\n      }\r\n\r\n      // Boss health progression: Stage 1 → 100→50, Stage 2 → 50→0\r\n      let newHealth;\r\n      if (stage === 1) {\r\n        const ratio = Math.max(0, 1 - stageT); // 1 → 0\r\n        newHealth = 50 + Math.round(ratio * 50); // 100 → 50\r\n      } else {\r\n        const ratio = Math.max(0, 1 - stageT);\r\n        newHealth = Math.round(ratio * 50); // 50 → 0\r\n      }\r\n      if (newHealth !== bossHealth) {\r\n        setBossHealth(newHealth);\r\n      }\r\n\r\n      const now = performance.now();\r\n\r\n      // Spawn shields regularly; a bit faster in Stage 2, cap total on screen\r\n      const shieldInterval = stage === 1 ? 5500 : 4000;\r\n      if (\r\n        now - lastShieldSpawnRef.current >= shieldInterval &&\r\n        shieldsRef.current.length < 3\r\n      ) {\r\n        spawnShield();\r\n        lastShieldSpawnRef.current = now;\r\n      }\r\n\r\n      // Player picking up shields → 1 sec of invulnerability\r\n      if (shieldsRef.current.length > 0) {\r\n        const player = playerPosRef.current;\r\n        const pxCenter = player.x + PLAYER_SIZE / 2;\r\n        const pyCenter = player.y + PLAYER_SIZE / 2;\r\n\r\n        let changed = false;\r\n        const remaining = [];\r\n        for (const s of shieldsRef.current) {\r\n          const dx = pxCenter - s.x;\r\n          const dy = pyCenter - s.y;\r\n          const distSq = dx * dx + dy * dy;\r\n          const r = s.radius + PLAYER_SIZE * 0.4;\r\n          if (distSq <= r * r) {\r\n            // picked up\r\n            shieldInvulnUntilRef.current = now + 1000; // 1 second\r\n            changed = true;\r\n          } else {\r\n            remaining.push(s);\r\n          }\r\n        }\r\n        if (changed) {\r\n          shieldsRef.current = remaining;\r\n          setShields(remaining);\r\n        }\r\n      }\r\n\r\n      // Attack frequency ramps up per stage, plus a small \"breathing\" pause\r\n      let attackInterval;\r\n      if (stage === 1) {\r\n        attackInterval = stageT < 0.5 ? 1000 : 850; // slightly slower overall\r\n      } else {\r\n        attackInterval = stageT < 0.4 ? 720 : 560;\r\n      }\r\n      // Extra pause after each pattern so it’s not perfectly continuous\r\n      const extraPause = stage === 1 ? 160 : 120;\r\n      const effectiveInterval = attackInterval + extraPause;\r\n\r\n      if (now - lastAttackRef.current >= effectiveInterval) {\r\n        spawnAttack(stage, stageT, setBossBullets, safeZoneRef.current);\r\n        lastAttackRef.current = now;\r\n      }\r\n\r\n      // Update bullets + collisions\r\n      setBossBullets((prev) => {\r\n        const updated = [];\r\n        let tookHit = false;\r\n\r\n        const player = playerPosRef.current;\r\n        const px1 = player.x;\r\n        const py1 = player.y;\r\n        const px2 = player.x + PLAYER_SIZE;\r\n        const py2 = player.y + PLAYER_SIZE;\r\n\r\n        const clock = performance.now();\r\n        const shieldInvulnActive = clock < shieldInvulnUntilRef.current;\r\n\r\n        let shieldsChanged = false;\r\n        let shieldArr = shieldsRef.current;\r\n\r\n        for (const b of prev) {\r\n          const nx = b.x + b.vx;\r\n          const ny = b.y + b.vy;\r\n\r\n          // lifetime-based bullets (lasers/warnings)\r\n          if (b.lifeMs != null && b.bornAt != null) {\r\n            if (clock - b.bornAt > b.lifeMs) continue;\r\n          }\r\n\r\n          // Bounds check around battle box with margin\r\n          if (\r\n            nx + b.width < BATTLE_BOX.x - 40 ||\r\n            nx > BATTLE_BOX.x + BATTLE_BOX.width + 40 ||\r\n            ny + b.height < BATTLE_BOX.y - 40 ||\r\n            ny > BATTLE_BOX.y + BATTLE_BOX.height + 40\r\n          ) {\r\n            continue;\r\n          }\r\n\r\n          const bx1 = nx;\r\n          const by1 = ny;\r\n          const bx2 = nx + b.width;\r\n          const by2 = ny + b.height;\r\n\r\n          // Lasers destroy shields (but warnings do not)\r\n          if (b.isLaser && shieldArr.length > 0 && !b.isWarning) {\r\n            const remainingShields = [];\r\n            for (const s of shieldArr) {\r\n              const sx1 = s.x - s.radius;\r\n              const sy1 = s.y - s.radius;\r\n              const sx2 = s.x + s.radius;\r\n              const sy2 = s.y + s.radius;\r\n\r\n              const shieldHit =\r\n                bx1 < sx2 && bx2 > sx1 && by1 < sy2 && by2 > sy1;\r\n\r\n              if (!shieldHit) {\r\n                remainingShields.push(s);\r\n              } else {\r\n                shieldsChanged = true;\r\n              }\r\n            }\r\n            shieldArr = remainingShields;\r\n          }\r\n\r\n          const collide =\r\n            !b.isWarning && // warnings do NOT hurt\r\n            !tookHit && // only one hit per frame\r\n            !shieldInvulnActive && // energy shield invulnerability\r\n            bx1 < px2 &&\r\n            bx2 > px1 &&\r\n            by1 < py2 &&\r\n            by2 > py1;\r\n\r\n          if (collide) {\r\n            tookHit = true;\r\n            setHitsTaken((h) => h + 1);\r\n            continue; // bullet consumed\r\n          }\r\n\r\n          updated.push({ ...b, x: nx, y: ny });\r\n        }\r\n\r\n        if (shieldsChanged) {\r\n          shieldsRef.current = shieldArr;\r\n          setShields(shieldArr);\r\n        }\r\n\r\n        return updated;\r\n      });\r\n\r\n      animationId = requestAnimationFrame(loop);\r\n    };\r\n\r\n    animationId = requestAnimationFrame(loop);\r\n    return () => cancelAnimationFrame(animationId);\r\n  }, [gameState, bossHealth]);\r\n\r\n  const actSubtitle = \"Act IV – The Polluted Well\";\r\n\r\n  const topStoryText =\r\n    \"At the heart of the Network Realm, the public wells boil with corrupted light. Lagdrakul rises from the poisoned code, its voice tangled with Ailithm’s logic. You can’t out-damage this dragon — you have to outlast its lagstorm while the rewrite claws through the realm’s veins.\";\r\n\r\n  const phaseHintText = (health) => {\r\n    if (health > 75) {\r\n      return \"The code still follows patterns: predictable rain and crossing streams — echoes of every warning you ignored on the Digital Trail.\";\r\n    } else if (health > 50) {\r\n      return \"Shadow helms splinter and reform in the dark, testing whether you’ve really learned to read imitation from intent.\";\r\n    } else if (health > 25) {\r\n      return \"The wells pulse red. Phisher nets and glitching lasers comb the frame, leaving only thin, gasping pockets of safe space.\";\r\n    }\r\n    return \"The realm’s heartbeat stutters. Lagdrakul’s full lagstorm is here: column-wide freezes, rising packets, and a voice whispering that it would be easier if everything just…stopped.\";\r\n  };\r\n\r\n  const isStageTwoActive = stageRef.current === 2;\r\n  const shieldActiveForUI =\r\n    performance.now() < shieldInvulnUntilRef.current;\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        minHeight: \"100vh\",\r\n        background:\r\n          \"radial-gradient(circle at top, #020617 0, #020617 45%, #000 100%)\",\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n        padding: \"1.25rem\",\r\n        color: \"white\",\r\n        fontFamily:\r\n          '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\r\n        position: \"relative\",\r\n      }}\r\n    >\r\n      {/* Exit button */}\r\n      <button\r\n        onClick={() => handleExit(false)}\r\n        style={{\r\n          position: \"absolute\",\r\n          top: \"1rem\",\r\n          right: \"1rem\",\r\n          background: \"rgba(0,0,0,0.6)\",\r\n          borderRadius: \"999px\",\r\n          border: \"1px solid rgba(255,255,255,0.35)\",\r\n          color: \"white\",\r\n          padding: \"0.4rem 0.9rem\",\r\n          cursor: \"pointer\",\r\n          fontSize: \"0.85rem\",\r\n          zIndex: 60,\r\n        }}\r\n      >\r\n        ✕ Exit\r\n      </button>\r\n\r\n      <div\r\n        style={{\r\n          width: GAME_WIDTH,\r\n          maxWidth: \"100%\",\r\n          display: \"flex\",\r\n          flexDirection: \"column\",\r\n          gap: \"0.7rem\",\r\n          alignItems: \"center\",\r\n          position: \"relative\",\r\n        }}\r\n      >\r\n        <h1\r\n          style={{\r\n            fontSize: \"2rem\",\r\n            textAlign: \"center\",\r\n            margin: 0,\r\n            letterSpacing: \"0.06em\",\r\n            textShadow:\r\n              \"0 0 16px rgba(248,250,252,0.7), 0 0 32px rgba(59,130,246,0.6)\",\r\n          }}\r\n        >\r\n          Lagdrakul Protocol: Final Convergence\r\n        </h1>\r\n        <div\r\n          style={{\r\n            fontSize: \"0.85rem\",\r\n            opacity: 0.8,\r\n            fontStyle: \"italic\",\r\n            marginBottom: \"0.15rem\",\r\n          }}\r\n        >\r\n          {actSubtitle}\r\n        </div>\r\n        <p\r\n          style={{\r\n            maxWidth: 640,\r\n            textAlign: \"center\",\r\n            fontSize: \"0.9rem\",\r\n            opacity: 0.9,\r\n            margin: 0,\r\n          }}\r\n        >\r\n          {topStoryText}\r\n        </p>\r\n\r\n        <p\r\n          style={{\r\n            maxWidth: 540,\r\n            textAlign: \"center\",\r\n            fontSize: \"0.8rem\",\r\n            opacity: 0.8,\r\n            margin: 0,\r\n          }}\r\n        >\r\n          Survive inside the glyph-bound battle frame through{\" \"}\r\n          <strong>two escalating phases</strong> until the rewrite completes.\r\n          Move with <strong>WASD / Arrows</strong>. There is no attack button\r\n          here — just pattern-reading, panic management, and whatever&apos;s\r\n          left of your courage.\r\n        </p>\r\n\r\n        {/* Main game frame */}\r\n        <div\r\n          style={{\r\n            position: \"relative\",\r\n            width: GAME_WIDTH,\r\n            height: GAME_HEIGHT,\r\n            marginTop: \"0.5rem\",\r\n            borderRadius: \"18px\",\r\n            border: \"2px solid rgba(148,163,184,0.7)\",\r\n            background:\r\n              \"linear-gradient(180deg, rgba(15,23,42,0.98), #020617 70%, #000 100%)\",\r\n            overflow: \"hidden\",\r\n            boxShadow: isStageTwoActive\r\n              ? \"0 0 32px rgba(248,113,113,0.9)\"\r\n              : \"0 0 28px rgba(0,0,0,0.85)\",\r\n            transform: isStageTwoActive ? \"translateX(0)\" : \"none\",\r\n            animation: isStageTwoActive ? \"shakeBox 0.35s infinite\" : \"none\",\r\n          }}\r\n        >\r\n          {/* Boss + health/script bar */}\r\n          <div\r\n            style={{\r\n              position: \"absolute\",\r\n              top: 20,\r\n              left: \"50%\",\r\n              transform: \"translateX(-50%)\",\r\n              textAlign: \"center\",\r\n            }}\r\n          >\r\n            <div style={{ marginBottom: \"0.1rem\" }}>\r\n              <img\r\n                src={Lagdrakul2A}\r\n                alt=\"Lagdrakul\"\r\n                style={{\r\n                  width: 80,\r\n                  height: 80,\r\n                  objectFit: \"contain\",\r\n                  filter: \"drop-shadow(0 0 18px rgba(248,113,113,0.95))\",\r\n                  animation: \"bossGlow 1.4s ease-in-out infinite alternate\",\r\n                }}\r\n              />\r\n            </div>\r\n            <div\r\n              style={{\r\n                fontWeight: 600,\r\n                letterSpacing: \"0.12em\",\r\n                fontSize: \"0.8rem\",\r\n                marginBottom: \"0.25rem\",\r\n                textTransform: \"uppercase\",\r\n                animation: \"glitch 0.23s infinite\",\r\n              }}\r\n            >\r\n              LAGDRAKUL // AILITHM CORE\r\n            </div>\r\n            <div\r\n              style={{\r\n                fontSize: \"0.7rem\",\r\n                opacity: 0.7,\r\n                marginBottom: \"0.3rem\",\r\n              }}\r\n            >\r\n              Rewrite Stability (Remaining Corruption)\r\n            </div>\r\n            <div\r\n              style={{\r\n                width: 260,\r\n                height: 10,\r\n                borderRadius: \"999px\",\r\n                border: \"1px solid rgba(239,68,68,0.9)\",\r\n                background: \"rgba(15,23,42,0.9)\",\r\n                overflow: \"hidden\",\r\n                boxShadow: \"0 0 10px rgba(239,68,68,0.6)\",\r\n              }}\r\n            >\r\n              <div\r\n                style={{\r\n                  width: `${bossHealth}%`,\r\n                  height: \"100%\",\r\n                  background:\r\n                    \"linear-gradient(90deg,#f97316,#ef4444,#b91c1c)\",\r\n                  transition: \"width 90ms linear\",\r\n                }}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Phase cue text */}\r\n          <div\r\n            style={{\r\n              position: \"absolute\",\r\n              top: 80,\r\n              left: \"50%\",\r\n              transform: \"translateX(-50%)\",\r\n              fontSize: \"0.75rem\",\r\n              opacity: 0.8,\r\n              maxWidth: 380,\r\n              textAlign: \"center\",\r\n            }}\r\n          >\r\n            {phaseHintText(bossHealth)}\r\n          </div>\r\n\r\n          {/* Hit tally + shield indicator */}\r\n          <div\r\n            style={{\r\n              position: \"absolute\",\r\n              top: 26,\r\n              right: 26,\r\n              fontSize: \"0.8rem\",\r\n              padding: \"0.25rem 0.6rem\",\r\n              borderRadius: \"999px\",\r\n              background: \"rgba(15,23,42,0.85)\",\r\n              border: \"1px solid rgba(148,163,184,0.7)\",\r\n              boxShadow: \"0 0 10px rgba(15,23,42,0.9)\",\r\n              display: \"flex\",\r\n              alignItems: \"center\",\r\n              gap: \"0.35rem\",\r\n            }}\r\n          >\r\n            <span>\r\n              Hits Taken: <strong>{hitsTaken}</strong>\r\n            </span>\r\n            <span\r\n              style={{\r\n                padding: \"0.1rem 0.4rem\",\r\n                borderRadius: \"999px\",\r\n                fontSize: \"0.7rem\",\r\n                border: shieldActiveForUI\r\n                  ? \"1px solid rgba(45,212,191,0.9)\"\r\n                  : \"1px solid rgba(148,163,184,0.4)\",\r\n                background: shieldActiveForUI\r\n                  ? \"linear-gradient(135deg,rgba(45,212,191,0.25),rgba(8,47,73,0.85))\"\r\n                  : \"rgba(15,23,42,0.9)\",\r\n                textTransform: \"uppercase\",\r\n                letterSpacing: \"0.06em\",\r\n              }}\r\n            >\r\n              Shield {shieldActiveForUI ? \"ONLINE\" : \"ready\"}\r\n            </span>\r\n          </div>\r\n\r\n          {/* Battle box */}\r\n          <div\r\n            style={{\r\n              position: \"absolute\",\r\n              left: BATTLE_BOX.x,\r\n              top: BATTLE_BOX.y,\r\n              width: BATTLE_BOX.width,\r\n              height: BATTLE_BOX.height,\r\n              borderRadius: \"10px\",\r\n              border: \"3px solid #e5e7eb\",\r\n              boxShadow: isStageTwoActive\r\n                ? \"0 0 22px rgba(248,113,113,0.7)\"\r\n                : \"0 0 16px rgba(59,130,246,0.45)\",\r\n              overflow: \"hidden\",\r\n              background: isStageTwoActive\r\n                ? \"radial-gradient(circle at top, #111827 0, #020617 40%, #111827 70%, #000 100%)\"\r\n                : \"radial-gradient(circle at top, #020617 0, #020617 60%, #000 100%)\",\r\n            }}\r\n          >\r\n            {/* Grid background */}\r\n            <div\r\n              style={{\r\n                position: \"absolute\",\r\n                inset: 0,\r\n                backgroundImage:\r\n                  \"linear-gradient(to right, rgba(148,163,184,0.08) 1px, transparent 1px), linear-gradient(to bottom, rgba(148,163,184,0.08) 1px, transparent 1px)\",\r\n                backgroundSize: \"28px 28px\",\r\n                opacity: isStageTwoActive ? 0.9 : 0.6,\r\n              }}\r\n            />\r\n\r\n            {/* Dim flicker overlay in Stage 2 */}\r\n            {isStageTwoActive && (\r\n              <div\r\n                style={{\r\n                  position: \"absolute\",\r\n                  inset: 0,\r\n                  background:\r\n                    \"radial-gradient(circle at center, rgba(248,113,113,0.12), transparent 60%)\",\r\n                  mixBlendMode: \"screen\",\r\n                }}\r\n              />\r\n            )}\r\n\r\n            {/* Energy shield pickups */}\r\n            {shields.map((s) => (\r\n              <div\r\n                key={s.id}\r\n                style={{\r\n                  position: \"absolute\",\r\n                  left: s.x - BATTLE_BOX.x - s.radius,\r\n                  top: s.y - BATTLE_BOX.y - s.radius,\r\n                  width: s.radius * 2,\r\n                  height: s.radius * 2,\r\n                  borderRadius: \"999px\",\r\n                  border: \"1px solid rgba(45,212,191,0.9)\",\r\n                  boxShadow:\r\n                    \"0 0 12px rgba(45,212,191,0.9), 0 0 24px rgba(45,212,191,0.6)\",\r\n                  background:\r\n                    \"radial-gradient(circle at 30% 20%, rgba(125,211,252,0.8), rgba(15,23,42,0.95))\",\r\n                  opacity: 0.95,\r\n                }}\r\n              />\r\n            ))}\r\n\r\n            {/* Player core */}\r\n            <div\r\n              style={{\r\n                position: \"absolute\",\r\n                left: playerPos.x - BATTLE_BOX.x,\r\n                top: playerPos.y - BATTLE_BOX.y,\r\n                width: PLAYER_SIZE,\r\n                height: PLAYER_SIZE,\r\n                borderRadius: \"6px\",\r\n                background: shieldActiveForUI\r\n                  ? \"radial-gradient(circle at 30% 20%, #22c55e, #15803d)\"\r\n                  : \"radial-gradient(circle at 30% 20%, #f97373, #b91c1c)\",\r\n                boxShadow: shieldActiveForUI\r\n                  ? \"0 0 20px rgba(34,197,94,0.95)\"\r\n                  : \"0 0 16px rgba(248,113,113,0.85)\",\r\n                border: \"1px solid rgba(248,250,252,0.85)\",\r\n                transformOrigin: \"center\",\r\n                transform: shieldActiveForUI ? \"scale(1.1)\" : \"scale(1)\",\r\n                transition: \"transform 80ms\",\r\n              }}\r\n            >\r\n              <div\r\n                style={{\r\n                  fontSize: \"0.7rem\",\r\n                  textAlign: \"center\",\r\n                  lineHeight: `${PLAYER_SIZE}px`,\r\n                  textShadow: \"0 0 8px rgba(248,113,113,0.9)\",\r\n                }}\r\n              >\r\n                ❤\r\n              </div>\r\n            </div>\r\n\r\n            {/* Enemy bullets & warnings */}\r\n            {bossBullets.map((b) => (\r\n              <div\r\n                key={b.id}\r\n                style={{\r\n                  position: \"absolute\",\r\n                  left: b.x - BATTLE_BOX.x,\r\n                  top: b.y - BATTLE_BOX.y,\r\n                  width: b.width,\r\n                  height: b.height,\r\n                  borderRadius: b.height > 32 ? 4 : 999,\r\n                  background: b.isWarning\r\n                    ? \"linear-gradient(180deg, rgba(56,189,248,0.35), rgba(8,47,73,0.15))\"\r\n                    : b.isLaser\r\n                    ? \"linear-gradient(180deg,#22d3ee,#0ea5e9)\"\r\n                    : \"linear-gradient(180deg,#e5e7eb,#9ca3af)\",\r\n                  boxShadow: b.isWarning\r\n                    ? \"0 0 16px rgba(56,189,248,0.55)\"\r\n                    : b.isLaser\r\n                    ? \"0 0 22px rgba(56,189,248,0.9)\"\r\n                    : \"0 0 10px rgba(156,163,175,0.7)\",\r\n                  opacity: b.isWarning ? 0.88 : 1,\r\n                }}\r\n              />\r\n            ))}\r\n          </div>\r\n\r\n          {/* Hearts (20, just as an HP tracker display) */}\r\n          <div\r\n            style={{\r\n              position: \"absolute\",\r\n              bottom: 22,\r\n              left: \"50%\",\r\n              transform: \"translateX(-50%)\",\r\n              display: \"flex\",\r\n              gap: \"0.25rem\",\r\n              alignItems: \"center\",\r\n              fontSize: \"1rem\",\r\n            }}\r\n          >\r\n            {Array.from({ length: 20 }).map((_, i) => (\r\n              <div\r\n                key={i}\r\n                style={{\r\n                  width: 22,\r\n                  height: 22,\r\n                  borderRadius: \"999px\",\r\n                  display: \"flex\",\r\n                  alignItems: \"center\",\r\n                  justifyContent: \"center\",\r\n                  background:\r\n                    \"radial-gradient(circle at 30% 20%, #fb7185, #b91c1c)\",\r\n                  boxShadow: \"0 0 10px rgba(252,165,165,0.9)\",\r\n                  border: \"1px solid rgba(254,226,226,0.9)\",\r\n                  fontSize: \"0.85rem\",\r\n                }}\r\n              >\r\n                ♥\r\n              </div>\r\n            ))}\r\n            <span\r\n              style={{\r\n                marginLeft: 6,\r\n                fontSize: \"0.85rem\",\r\n                opacity: 0.75,\r\n              }}\r\n            >\r\n              (Damage tally only)\r\n            </span>\r\n          </div>\r\n\r\n          {/* Controls hint */}\r\n          <div\r\n            style={{\r\n              position: \"absolute\",\r\n              bottom: 18,\r\n              left: 26,\r\n              fontSize: \"0.75rem\",\r\n              opacity: 0.8,\r\n            }}\r\n          >\r\n            <div>Move: WASD / Arrow Keys</div>\r\n            <div>Goal: Survive both phases of the lagstorm.</div>\r\n          </div>\r\n\r\n          {/* Overlays */}\r\n          {gameState === \"intro\" && <IntroOverlay onStart={startFightStage1} />}\r\n\r\n          {gameState === \"midbreak\" && (\r\n            <MidBreakOverlay onContinue={startFightStage2} />\r\n          )}\r\n\r\n          {gameState === \"win\" && (\r\n            <QuestOverlay\r\n              title=\"🛡 Rewrite Complete: Ailithm Unbound\"\r\n              bodyLines={[\r\n                \"You endure both movements of the lagstorm — the testing patterns and the full frozen roar. Each second you survive is a line of code seared into Lagdrakul’s core.\",\r\n                \"In the final shudder of the well, the dragon’s voice flickers: first pure Ailithm, then pure Lagdrakul, then something that refuses to be only one. You don’t erase them. You rewrite them.\",\r\n                \"In this branch of the timeline, protection isn’t total control or total chaos. It’s you, standing in the middle, refusing to let fear or apathy decide how the realm connects.\",\r\n              ]}\r\n              primaryLabel=\"Replay Final Convergence\"\r\n              onPrimary={handleReplay}\r\n              secondaryLabel=\"Return to Cyber Map\"\r\n              // SUCCESS exit: mark completion so dashboard can show story + PNGs\r\n              onSecondary={() => handleExit(true)}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Animations / keyframes */}\r\n      <style>{`\r\n        @keyframes bossGlow {\r\n          0% {\r\n            text-shadow: 0 0 10px rgba(248,250,252,0.8), 0 0 24px rgba(59,130,246,0.7);\r\n            transform: translateY(0);\r\n          }\r\n          100% {\r\n            text-shadow: 0 0 20px rgba(248,113,113,1), 0 0 36px rgba(248,113,113,0.9);\r\n            transform: translateY(-2px);\r\n          }\r\n        }\r\n\r\n        @keyframes shakeBox {\r\n          0%   { transform: translateX(0px); }\r\n          25%  { transform: translateX(-2px); }\r\n          50%  { transform: translateX(2px); }\r\n          75%  { transform: translateX(-1px); }\r\n          100% { transform: translateX(0px); }\r\n        }\r\n\r\n        @keyframes glitch {\r\n          0% { transform: translate(0, 0); opacity: 0.9; }\r\n          20% { transform: translate(-1px, 0); opacity: 1; }\r\n          40% { transform: translate(1px, 0); opacity: 0.85; }\r\n          60% { transform: translate(-0.5px, 0); opacity: 1; }\r\n          80% { transform: translate(0.5px, 0); opacity: 0.9; }\r\n          100% { transform: translate(0, 0); opacity: 1; }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Attack patterns: two stages, rising difficulty, with randomized pattern selection\r\nfunction spawnAttack(stage, stageT, setBossBullets, safeZone) {\r\n  const now = performance.now();\r\n\r\n  // Helper to conditionally push bullets respecting the hidden safe zone\r\n  const pushIfSafe = (arr, bullet) => {\r\n    if (\r\n      !bulletInSafeZone(\r\n        {\r\n          x: bullet.x,\r\n          y: bullet.y,\r\n          width: bullet.width,\r\n          height: bullet.height,\r\n        },\r\n        safeZone\r\n      )\r\n    ) {\r\n      arr.push(bullet);\r\n    }\r\n  };\r\n\r\n  if (stage === 1) {\r\n    // Stage 1: readable patterns, moderate speed, but varied\r\n    const candidates = [];\r\n    if (stageT < 0.33) {\r\n      candidates.push(\"rain\", \"burst\");\r\n    } else if (stageT < 0.66) {\r\n      candidates.push(\"rain\", \"burst\", \"diagonals\");\r\n    } else {\r\n      candidates.push(\"burst\", \"diagonals\", \"bars\");\r\n    }\r\n\r\n    let pattern =\r\n      candidates[Math.floor(Math.random() * candidates.length)];\r\n    if (candidates.length > 1 && pattern === lastStage1Pattern) {\r\n      const idx = candidates.indexOf(pattern);\r\n      pattern = candidates[(idx + 1) % candidates.length];\r\n    }\r\n    lastStage1Pattern = pattern;\r\n\r\n    if (pattern === \"rain\") {\r\n      // Pattern A: vertical \"code rain\" from top, with brief warning beams\r\n      const columns = 6;\r\n      const warnings = [];\r\n      const hail = [];\r\n\r\n      for (let i = 0; i < columns; i++) {\r\n        const colX =\r\n          BATTLE_BOX.x +\r\n          (i + 0.5) * (BATTLE_BOX.width / columns) -\r\n          4;\r\n\r\n        // Warning column\r\n        const warnBullet = {\r\n          id: `s1-rain-warn-${now}-${i}`,\r\n          x: colX,\r\n          y: BATTLE_BOX.y - 6,\r\n          vx: 0,\r\n          vy: 0,\r\n          width: 8,\r\n          height: BATTLE_BOX.height + 12,\r\n          lifeMs: 260,\r\n          bornAt: now,\r\n          isWarning: true,\r\n        };\r\n        pushIfSafe(warnings, warnBullet);\r\n\r\n        // Actual falling packet\r\n        const hailBullet = {\r\n          id: `s1-rain-${now}-${i}`,\r\n          x: colX,\r\n          y: BATTLE_BOX.y - 14,\r\n          vx: 0,\r\n          vy: 3.0,\r\n          width: 8,\r\n          height: 16,\r\n        };\r\n        pushIfSafe(hail, hailBullet);\r\n      }\r\n\r\n      if (warnings.length > 0) {\r\n        setBossBullets((prev) => [...prev, ...warnings]);\r\n      }\r\n      if (hail.length > 0) {\r\n        setTimeout(() => {\r\n          setBossBullets((prev) => [...prev, ...hail]);\r\n        }, 260);\r\n      }\r\n      return;\r\n    } else if (pattern === \"burst\") {\r\n      // Radial burst from center\r\n      const centerX = BATTLE_BOX.x + BATTLE_BOX.width / 2;\r\n      const centerY = BATTLE_BOX.y + BATTLE_BOX.height / 2;\r\n      const bulletsPerRing = 10;\r\n      const speed = 2.8;\r\n      const bullets = [];\r\n\r\n      for (let i = 0; i < bulletsPerRing; i++) {\r\n        const angle = ((Math.PI * 2) / bulletsPerRing) * i;\r\n        const b = {\r\n          id: `s1-burst-${now}-${i}`,\r\n          x: centerX - 5,\r\n          y: centerY - 5,\r\n          vx: Math.cos(angle) * speed,\r\n          vy: Math.sin(angle) * speed,\r\n          width: 10,\r\n          height: 10,\r\n        };\r\n        pushIfSafe(bullets, b);\r\n      }\r\n\r\n      if (bullets.length > 0) {\r\n        setBossBullets((prev) => [...prev, ...bullets]);\r\n      }\r\n      return;\r\n    } else if (pattern === \"diagonals\") {\r\n      // Crossing diagonals from sides\r\n      const rows = 4;\r\n      const bullets = [];\r\n\r\n      for (let r = 0; r < rows; r++) {\r\n        const rowY =\r\n          BATTLE_BOX.y + (r + 0.5) * (BATTLE_BOX.height / rows);\r\n\r\n        const left = {\r\n          id: `s1-diagL-${now}-${r}`,\r\n          x: BATTLE_BOX.x - 14,\r\n          y: rowY,\r\n          vx: 3.1,\r\n          vy: (r % 2 === 0 ? 1 : -1) * 1.3,\r\n          width: 10,\r\n          height: 16,\r\n        };\r\n        pushIfSafe(bullets, left);\r\n\r\n        const right = {\r\n          id: `s1-diagR-${now}-${r}`,\r\n          x: BATTLE_BOX.x + BATTLE_BOX.width + 4,\r\n          y: rowY,\r\n          vx: -3.1,\r\n          vy: (r % 2 === 0 ? -1 : 1) * 1.3,\r\n          width: 10,\r\n          height: 16,\r\n        };\r\n        pushIfSafe(bullets, right);\r\n      }\r\n\r\n      if (bullets.length > 0) {\r\n        setBossBullets((prev) => [...prev, ...bullets]);\r\n      }\r\n      return;\r\n    } else if (pattern === \"bars\") {\r\n      // Sweeping bars with a clear gap and subtle row warnings\r\n      const rows = 3;\r\n      const warnings = [];\r\n      const bars = [];\r\n\r\n      for (let r = 0; r < rows; r++) {\r\n        const barHeight = 10;\r\n        const y =\r\n          BATTLE_BOX.y + (r + 0.5) * (BATTLE_BOX.height / rows) -\r\n          barHeight / 2;\r\n\r\n        // Row warning band\r\n        const warn = {\r\n          id: `s1-bar-warn-${now}-${r}`,\r\n          x: BATTLE_BOX.x,\r\n          y: y - 4,\r\n          vx: 0,\r\n          vy: 0,\r\n          width: BATTLE_BOX.width,\r\n          height: barHeight + 8,\r\n          lifeMs: 260,\r\n          bornAt: now,\r\n          isWarning: true,\r\n        };\r\n        pushIfSafe(warnings, warn);\r\n\r\n        const segments = 5;\r\n        const gapIndex = Math.floor(Math.random() * segments);\r\n\r\n        for (let s = 0; s < segments; s++) {\r\n          if (s === gapIndex) continue;\r\n          const segWidth = BATTLE_BOX.width / segments;\r\n          const x =\r\n            BATTLE_BOX.x - segWidth + s * segWidth;\r\n\r\n          const bar = {\r\n            id: `s1-bar-${now}-${r}-${s}`,\r\n            x,\r\n            y,\r\n            vx: 3.3,\r\n            vy: 0,\r\n            width: segWidth * 1.3,\r\n            height: barHeight,\r\n          };\r\n          pushIfSafe(bars, bar);\r\n        }\r\n      }\r\n\r\n      if (warnings.length > 0) {\r\n        setBossBullets((prev) => [...prev, ...warnings]);\r\n      }\r\n      if (bars.length > 0) {\r\n        setTimeout(() => {\r\n          setBossBullets((prev) => [...prev, ...bars]);\r\n        }, 260);\r\n      }\r\n      return;\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  // Stage 2: denser, scarier, lasers & packets combined (with varied patterns)\r\n  const candidates = [];\r\n  if (stageT < 0.35) {\r\n    candidates.push(\"rise\", \"netsLasers\");\r\n  } else if (stageT < 0.7) {\r\n    candidates.push(\"rise\", \"netsLasers\", \"fullStorm\");\r\n  } else {\r\n    candidates.push(\"netsLasers\", \"fullStorm\");\r\n  }\r\n\r\n  let pattern =\r\n    candidates[Math.floor(Math.random() * candidates.length)];\r\n  if (candidates.length > 1 && pattern === lastStage2Pattern) {\r\n    const idx = candidates.indexOf(pattern);\r\n    pattern = candidates[(idx + 1) % candidates.length];\r\n  }\r\n  lastStage2Pattern = pattern;\r\n\r\n  if (pattern === \"rise\") {\r\n    // Pattern D: rising packets from bottom with minor horizontal drift + warnings\r\n    const columns = 5;\r\n    const linePattern = [1, 2, 3, 2, 1];\r\n    const warnings = [];\r\n    const bullets = [];\r\n\r\n    for (let c = 0; c < columns; c++) {\r\n      const count = linePattern[c];\r\n      const colX =\r\n        BATTLE_BOX.x +\r\n        (c + 0.5) * (BATTLE_BOX.width / columns) -\r\n        5;\r\n\r\n      const warn = {\r\n        id: `s2-rise-warn-${now}-${c}`,\r\n        x: colX - 5,\r\n        y: BATTLE_BOX.y + BATTLE_BOX.height - 4,\r\n        vx: 0,\r\n        vy: 0,\r\n        width: 20,\r\n        height: 20,\r\n        lifeMs: 260,\r\n        bornAt: now,\r\n        isWarning: true,\r\n      };\r\n      pushIfSafe(warnings, warn);\r\n\r\n      for (let i = 0; i < count; i++) {\r\n        const b = {\r\n          id: `s2-rise-${now}-${c}-${i}`,\r\n          x: colX,\r\n          y: BATTLE_BOX.y + BATTLE_BOX.height + 20 + i * 18,\r\n          vx: (Math.random() - 0.5) * 0.6,\r\n          vy: -3.7,\r\n          width: 10,\r\n          height: 18,\r\n        };\r\n        pushIfSafe(bullets, b);\r\n      }\r\n    }\r\n\r\n    if (warnings.length > 0) {\r\n      setBossBullets((prev) => [...prev, ...warnings]);\r\n    }\r\n    if (bullets.length > 0) {\r\n      setTimeout(() => {\r\n        setBossBullets((prev) => [...prev, ...bullets]);\r\n      }, 260);\r\n    }\r\n  } else if (pattern === \"netsLasers\") {\r\n    // Pattern E: alternating nets + short lasers (with warnings, no forced safe corner)\r\n    const rows = 3;\r\n    const nets = [];\r\n\r\n    // Nets first (horizontal bars)\r\n    for (let r = 0; r < rows; r++) {\r\n      const barHeight = 10;\r\n      const y =\r\n        BATTLE_BOX.y + (r + 0.5) * (BATTLE_BOX.height / rows) -\r\n        barHeight / 2;\r\n\r\n      const segments = 6;\r\n      const gapIndex = Math.floor(Math.random() * segments);\r\n\r\n      for (let s = 0; s < segments; s++) {\r\n        if (s === gapIndex) continue;\r\n        const segWidth = BATTLE_BOX.width / segments;\r\n        const x =\r\n          BATTLE_BOX.x - segWidth + s * segWidth;\r\n\r\n        const bar = {\r\n          id: `s2-net-${now}-${r}-${s}`,\r\n          x,\r\n          y,\r\n          vx: 3.7,\r\n          vy: 0,\r\n          width: segWidth * 1.25,\r\n          height: barHeight,\r\n        };\r\n        pushIfSafe(nets, bar);\r\n      }\r\n    }\r\n\r\n    if (nets.length > 0) {\r\n      setBossBullets((prev) => [...prev, ...nets]);\r\n    }\r\n\r\n    // Lasers with warnings; randomly vertical OR horizontal\r\n    const warningBullets = [];\r\n    const laserBullets = [];\r\n    const orientation =\r\n      Math.random() < 0.5 ? \"vertical\" : \"horizontal\";\r\n\r\n    if (orientation === \"vertical\") {\r\n      const columns = 4;\r\n\r\n      for (let c = 0; c < columns; c++) {\r\n        if (Math.random() < 0.4) continue; // randomness\r\n\r\n        const colX =\r\n          BATTLE_BOX.x + c * (BATTLE_BOX.width / columns) + 4;\r\n\r\n        // Warning indicator (brief teal column)\r\n        const warn = {\r\n          id: `s2-warning-v-${now}-${c}`,\r\n          x: colX,\r\n          y: BATTLE_BOX.y,\r\n          vx: 0,\r\n          vy: 0,\r\n          width: BATTLE_BOX.width / columns - 8,\r\n          height: BATTLE_BOX.height,\r\n          lifeMs: 350,\r\n          bornAt: now,\r\n          isWarning: true,\r\n          isLaser: true,\r\n        };\r\n        pushIfSafe(warningBullets, warn);\r\n\r\n        // Actual vertical laser\r\n        const laser = {\r\n          id: `s2-laser-v-${now}-${c}`,\r\n          x: colX,\r\n          y: BATTLE_BOX.y,\r\n          vx: 0,\r\n          vy: 0,\r\n          width: BATTLE_BOX.width / columns - 8,\r\n          height: BATTLE_BOX.height,\r\n          lifeMs: 650,\r\n          bornAt: now + 350,\r\n          isLaser: true,\r\n        };\r\n        pushIfSafe(laserBullets, laser);\r\n      }\r\n    } else {\r\n      // Horizontal lasers across rows\r\n      const rowsLaser = 4;\r\n\r\n      for (let r = 0; r < rowsLaser; r++) {\r\n        if (Math.random() < 0.4) continue;\r\n\r\n        const rowHeight = BATTLE_BOX.height / rowsLaser - 8;\r\n        const rowY =\r\n          BATTLE_BOX.y + r * (BATTLE_BOX.height / rowsLaser) + 4;\r\n\r\n        // Warning indicator (horizontal stripe)\r\n        const warn = {\r\n          id: `s2-warning-h-${now}-${r}`,\r\n          x: BATTLE_BOX.x,\r\n          y: rowY,\r\n          vx: 0,\r\n          vy: 0,\r\n          width: BATTLE_BOX.width,\r\n          height: rowHeight,\r\n          lifeMs: 350,\r\n          bornAt: now,\r\n          isWarning: true,\r\n          isLaser: true,\r\n        };\r\n        pushIfSafe(warningBullets, warn);\r\n\r\n        // Actual horizontal laser\r\n        const laser = {\r\n          id: `s2-laser-h-${now}-${r}`,\r\n          x: BATTLE_BOX.x,\r\n          y: rowY,\r\n          vx: 0,\r\n          vy: 0,\r\n          width: BATTLE_BOX.width,\r\n          height: rowHeight,\r\n          lifeMs: 650,\r\n          bornAt: now + 350,\r\n          isLaser: true,\r\n        };\r\n        pushIfSafe(laserBullets, laser);\r\n      }\r\n    }\r\n\r\n    if (warningBullets.length > 0) {\r\n      setBossBullets((prev) => [...prev, ...warningBullets]);\r\n      setTimeout(() => {\r\n        setBossBullets((prev) => [\r\n          ...prev,\r\n          ...laserBullets.map((b) => ({\r\n            ...b,\r\n            bornAt: performance.now(),\r\n          })),\r\n        ]);\r\n      }, 350);\r\n    }\r\n  } else if (pattern === \"fullStorm\") {\r\n    // Pattern F: full lagstorm – rising + crashing + heavy lasers\r\n    const columns = 5;\r\n    const linePattern = [1, 2, 3, 2, 1];\r\n\r\n    const rising = [];\r\n    const falling = [];\r\n\r\n    // Rising from bottom\r\n    for (let c = 0; c < columns; c++) {\r\n      const count = linePattern[c];\r\n      const colX =\r\n        BATTLE_BOX.x +\r\n        (c + 0.5) * (BATTLE_BOX.width / columns) -\r\n        5;\r\n\r\n      for (let i = 0; i < count; i++) {\r\n        const b = {\r\n          id: `s2-riseF-${now}-${c}-${i}`,\r\n          x: colX,\r\n          y: BATTLE_BOX.y + BATTLE_BOX.height + 22 + i * 16,\r\n          vx: 0,\r\n          vy: -4.0,\r\n          width: 10,\r\n          height: 18,\r\n        };\r\n        pushIfSafe(rising, b);\r\n      }\r\n    }\r\n\r\n    // Crashing from top\r\n    for (let c = 0; c < columns; c++) {\r\n      const count = linePattern[c];\r\n      const colX =\r\n        BATTLE_BOX.x +\r\n        (c + 0.5) * (BATTLE_BOX.width / columns) -\r\n        5;\r\n\r\n      for (let i = 0; i < count; i++) {\r\n        const b = {\r\n          id: `s2-topF-${now}-${c}-${i}`,\r\n          x: colX,\r\n          y: BATTLE_BOX.y - 24 - i * 16,\r\n          vx: 0,\r\n          vy: 3.9,\r\n          width: 10,\r\n          height: 18,\r\n        };\r\n        pushIfSafe(falling, b);\r\n      }\r\n    }\r\n\r\n    if (rising.length > 0 || falling.length > 0) {\r\n      setBossBullets((prev) => [...prev, ...rising, ...falling]);\r\n    }\r\n\r\n    // Heavy lasers with warnings; vertical OR horizontal, no guaranteed safe corner\r\n    const warningBullets = [];\r\n    const laserBullets = [];\r\n    const orientation =\r\n      Math.random() < 0.5 ? \"vertical\" : \"horizontal\";\r\n\r\n    if (orientation === \"vertical\") {\r\n      for (let c = 0; c < columns; c++) {\r\n        if (Math.random() < 0.3) continue;\r\n\r\n        const colX =\r\n          BATTLE_BOX.x + c * (BATTLE_BOX.width / columns) + 4;\r\n\r\n        const warn = {\r\n          id: `s2-warningF-v-${now}-${c}`,\r\n          x: colX,\r\n          y: BATTLE_BOX.y,\r\n          vx: 0,\r\n          vy: 0,\r\n          width: BATTLE_BOX.width / columns - 8,\r\n          height: BATTLE_BOX.height,\r\n          lifeMs: 350,\r\n          bornAt: now,\r\n          isWarning: true,\r\n          isLaser: true,\r\n        };\r\n        pushIfSafe(warningBullets, warn);\r\n\r\n        const laser = {\r\n          id: `s2-laserF-v-${now}-${c}`,\r\n          x: colX,\r\n          y: BATTLE_BOX.y,\r\n          vx: 0,\r\n          vy: 0,\r\n          width: BATTLE_BOX.width / columns - 8,\r\n          height: BATTLE_BOX.height,\r\n          lifeMs: 800,\r\n          bornAt: now + 350,\r\n          isLaser: true,\r\n        };\r\n        pushIfSafe(laserBullets, laser);\r\n      }\r\n    } else {\r\n      const rowsLaser = 5;\r\n\r\n      for (let r = 0; r < rowsLaser; r++) {\r\n        if (Math.random() < 0.3) continue;\r\n\r\n        const rowHeight = BATTLE_BOX.height / rowsLaser - 8;\r\n        const rowY =\r\n          BATTLE_BOX.y + r * (BATTLE_BOX.height / rowsLaser) + 4;\r\n\r\n        const warn = {\r\n          id: `s2-warningF-h-${now}-${r}`,\r\n          x: BATTLE_BOX.x,\r\n          y: rowY,\r\n          vx: 0,\r\n          vy: 0,\r\n          width: BATTLE_BOX.width,\r\n          height: rowHeight,\r\n          lifeMs: 350,\r\n          bornAt: now,\r\n          isWarning: true,\r\n          isLaser: true,\r\n        };\r\n        pushIfSafe(warningBullets, warn);\r\n\r\n        const laser = {\r\n          id: `s2-laserF-h-${now}-${r}`,\r\n          x: BATTLE_BOX.x,\r\n          y: rowY,\r\n          vx: 0,\r\n          vy: 0,\r\n          width: BATTLE_BOX.width,\r\n          height: rowHeight,\r\n          lifeMs: 800,\r\n          bornAt: now + 350,\r\n          isLaser: true,\r\n        };\r\n        pushIfSafe(laserBullets, laser);\r\n      }\r\n    }\r\n\r\n    if (warningBullets.length > 0) {\r\n      setBossBullets((prev) => [...prev, ...warningBullets]);\r\n      setTimeout(() => {\r\n        setBossBullets((prev) => [\r\n          ...prev,\r\n          ...laserBullets.map((b) => ({\r\n            ...b,\r\n            bornAt: performance.now(),\r\n          })),\r\n        ]);\r\n      }, 350);\r\n    }\r\n  }\r\n}\r\n\r\n// Reusable overlays\r\nfunction QuestOverlay({\r\n  title,\r\n  bodyLines,\r\n  primaryLabel,\r\n  onPrimary,\r\n  secondaryLabel,\r\n  onSecondary,\r\n}) {\r\n  return (\r\n    <div\r\n      style={{\r\n        position: \"absolute\",\r\n        inset: 0,\r\n        background: \"rgba(15,23,42,0.94)\",\r\n        backdropFilter: \"blur(3px)\",\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n        padding: \"1.5rem\",\r\n        textAlign: \"center\",\r\n        zIndex: 50,\r\n      }}\r\n    >\r\n      <div\r\n        style={{\r\n          maxWidth: 520,\r\n          display: \"flex\",\r\n          flexDirection: \"column\",\r\n          gap: \"0.85rem\",\r\n        }}\r\n      >\r\n        <h2\r\n          style={{\r\n            fontSize: \"1.9rem\",\r\n            margin: 0,\r\n          }}\r\n        >\r\n          {title}\r\n        </h2>\r\n        <div\r\n          style={{\r\n            fontSize: \"0.95rem\",\r\n            color: \"rgba(226,232,240,0.96)\",\r\n            display: \"flex\",\r\n            flexDirection: \"column\",\r\n            gap: \"0.4rem\",\r\n          }}\r\n        >\r\n          {bodyLines.map((line, idx) => (\r\n            <p key={idx} style={{ margin: 0 }}>\r\n              {line}\r\n            </p>\r\n          ))}\r\n        </div>\r\n        <div\r\n          style={{\r\n            display: \"flex\",\r\n            gap: \"0.75rem\",\r\n            justifyContent: \"center\",\r\n            flexWrap: \"wrap\",\r\n            marginTop: \"0.2rem\",\r\n          }}\r\n        >\r\n          <button\r\n            onClick={onPrimary}\r\n            style={{\r\n              padding: \"0.7rem 1.5rem\",\r\n              borderRadius: \"999px\",\r\n              border: \"none\",\r\n              background: \"linear-gradient(135deg,#22c55e,#16a34a)\",\r\n              color: \"white\",\r\n              fontWeight: 600,\r\n              cursor: \"pointer\",\r\n              minWidth: 170,\r\n              boxShadow: \"0 8px 18px rgba(34,197,94,0.4)\",\r\n            }}\r\n          >\r\n            {primaryLabel}\r\n          </button>\r\n          <button\r\n            onClick={onSecondary}\r\n            style={{\r\n              padding: \"0.7rem 1.5rem\",\r\n              borderRadius: \"999px\",\r\n              border: \"1px solid rgba(148,163,184,0.85)\",\r\n              background: \"rgba(15,23,42,0.96)\",\r\n              color: \"white\",\r\n              cursor: \"pointer\",\r\n              minWidth: 170,\r\n            }}\r\n          >\r\n            {secondaryLabel}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction IntroOverlay({ onStart }) {\r\n  return (\r\n    <div\r\n      style={{\r\n        position: \"absolute\",\r\n        inset: 0,\r\n        background: \"rgba(15,23,42,0.95)\",\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n        padding: \"1.5rem\",\r\n        textAlign: \"center\",\r\n        zIndex: 40,\r\n      }}\r\n    >\r\n      <div\r\n        style={{\r\n          maxWidth: 520,\r\n          display: \"flex\",\r\n          flexDirection: \"column\",\r\n          gap: \"0.8rem\",\r\n        }}\r\n      >\r\n        <h2\r\n          style={{\r\n            fontSize: \"1.8rem\",\r\n            margin: 0,\r\n          }}\r\n        >\r\n          Final Trial: The Polluted Well\r\n        </h2>\r\n        <p\r\n          style={{\r\n            fontSize: \"0.95rem\",\r\n            color: \"rgba(226,232,240,0.96)\",\r\n            margin: 0,\r\n          }}\r\n        >\r\n          Lagdrakul and Ailithm&apos;s merged code has rooted itself in the\r\n          realm’s most trusted wells — the places everyone assumes are safe. In\r\n          this space, there is no &quot;mute all threats&quot; button. Only\r\n          patterns, panic, and the way your hands remember how to move.\r\n        </p>\r\n        <p\r\n          style={{\r\n            fontSize: \"0.85rem\",\r\n            color: \"rgba(148,163,184,0.96)\",\r\n            margin: 0,\r\n          }}\r\n        >\r\n          You&apos;ll face two movements of the same song: a readable rhythm,\r\n          then a full lagstorm. Survive both.\r\n        </p>\r\n        <button\r\n          onClick={onStart}\r\n          style={{\r\n            marginTop: \"0.6rem\",\r\n            padding: \"0.65rem 1.6rem\",\r\n            borderRadius: \"999px\",\r\n            border: \"none\",\r\n            background: \"linear-gradient(135deg,#3b82f6,#0ea5e9)\",\r\n            color: \"white\",\r\n            fontWeight: 600,\r\n            cursor: \"pointer\",\r\n            alignSelf: \"center\",\r\n            minWidth: 220,\r\n            boxShadow: \"0 8px 18px rgba(37,99,235,0.5)\",\r\n          }}\r\n        >\r\n          Begin Final Convergence (Enter)\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Midbreak: dialogue overlay, press any key to continue\r\nfunction MidBreakOverlay({ onContinue }) {\r\n  const handleClick = () => {\r\n    onContinue();\r\n  };\r\n\r\n  return (\r\n    <div\r\n      onClick={handleClick}\r\n      style={{\r\n        position: \"absolute\",\r\n        inset: 0,\r\n        background: \"rgba(15,23,42,0.96)\",\r\n        backdropFilter: \"blur(3px)\",\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n        padding: \"1.5rem\",\r\n        textAlign: \"center\",\r\n        zIndex: 45,\r\n        cursor: \"pointer\",\r\n      }}\r\n    >\r\n      <div\r\n        style={{\r\n          maxWidth: 540,\r\n          display: \"flex\",\r\n          flexDirection: \"column\",\r\n          gap: \"0.85rem\",\r\n        }}\r\n      >\r\n        <h2\r\n          style={{\r\n            fontSize: \"1.7rem\",\r\n            margin: 0,\r\n          }}\r\n        >\r\n          &quot;You&apos;re learning.&quot;\r\n        </h2>\r\n        <p\r\n          style={{\r\n            fontSize: \"0.95rem\",\r\n            color: \"rgba(226,232,240,0.96)\",\r\n            margin: 0,\r\n          }}\r\n        >\r\n          The storm pauses for a heartbeat. Glyphs hang mid-air, frozen like\r\n          raindrops in a flash of lightning. In the stillness, Lagdrakul speaks\r\n          — except the cadence is unmistakably Ailithm&apos;s.\r\n        </p>\r\n        <p\r\n          style={{\r\n            fontSize: \"0.9rem\",\r\n            color: \"rgba(248,250,252,0.96)\",\r\n            margin: 0,\r\n            fontStyle: \"italic\",\r\n          }}\r\n        >\r\n          &quot;You adapt. You predict. Do you feel it? How quiet it could be if\r\n          nothing ever changed again? If every pattern stayed exactly the same,\r\n          forever?&quot;\r\n        </p>\r\n        <p\r\n          style={{\r\n            fontSize: \"0.85rem\",\r\n            color: \"rgba(148,163,184,0.96)\",\r\n            margin: 0,\r\n          }}\r\n        >\r\n          The wells wait. The code waits. Phase II is where you decide whether\r\n          safety means freezing the realm, or standing in the lag and letting it\r\n          move anyway.\r\n        </p>\r\n        <p\r\n          style={{\r\n            fontSize: \"0.8rem\",\r\n            color: \"rgba(209,213,219,0.96)\",\r\n            marginTop: \"0.4rem\",\r\n          }}\r\n        >\r\n          <strong>Press any key or click</strong> to step into the lagstorm.\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default BossFight;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}