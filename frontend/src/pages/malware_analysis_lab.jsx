import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Sword, ArrowLeft, Bug, AlertOctagon, CheckCircle, XCircle, Trophy, Zap, Target, Shield, Download, Smartphone } from 'lucide-react';
import '../App.css';

export default function MalwareAnalysisGame() {
  const navigate = useNavigate();
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [score, setScore] = useState(0);
  const [showResult, setShowResult] = useState(false);
  const [selectedAnswer, setSelectedAnswer] = useState(null);
  const [quizCompleted, setQuizCompleted] = useState(false);

  // Quiz questions
  const quizQuestions = [
    {
      question: "What is MALWARE? ü¶†",
      options: [
        "A cool new video game",
        "BAD software designed to harm your computer or steal your stuff",
        "A type of email",
        "A website for shopping"
      ],
      correct: 1,
      explanation: "Perfect! MALWARE = MALicious softWARE. It's like digital germs that can make your computer sick, steal your passwords, or spy on you. That's why we need antivirus protection! üõ°Ô∏è"
    },
    {
      question: "You want to download a free game called 'Minecraft_PRO_Free.exe' from a random website. What should you do?",
      options: [
        "Download it! Free games are awesome!",
        "DON'T download it! It's probably malware pretending to be Minecraft",
        "Ask my friends if they've tried it first",
        "Download it but don't open it"
      ],
      correct: 1,
      explanation: "Great thinking! üß† Real Minecraft isn't free, so this is 100% a trap! Scammers disguise malware as popular games or apps. Only download from official stores like the App Store, Google Play, or official websites!"
    },
    {
      question: "What's a VIRUS in computer terms? ü¶†",
      options: [
        "A sick computer that needs medicine",
        "Malicious code that copies itself and spreads to other files/computers",
        "A bug crawling on your screen",
        "A broken computer part"
      ],
      correct: 1,
      explanation: "Exactly! A computer virus works like a real virus - it infects files, makes copies of itself, and spreads to other computers! That's why it's called a virus. Keep your antivirus updated to fight them! üíâ"
    },
    {
      question: "Your friend sends you a USB drive with 'cool games' on it. Should you plug it into your computer?",
      options: [
        "Yes! My friend wouldn't hurt me",
        "No! USB drives can spread malware even from friends",
        "Maybe, if I scan it first with antivirus",
        "Yes, but only on my parents' computer"
      ],
      correct: 2,
      explanation: "Smart move! üéØ Your friend might not know the USB has malware on it! ALWAYS scan USB drives with antivirus before opening any files. Malware can hide on USB drives and infect any computer it's plugged into!"
    },
    {
      question: "What is a TROJAN HORSE virus? üê¥",
      options: [
        "A virus from ancient Greece",
        "Malware that pretends to be helpful software but is actually harmful",
        "A virus that only affects horses",
        "A game about horses"
      ],
      correct: 1,
      explanation: "Nailed it! üé≠ Just like the ancient Greek story, Trojan malware pretends to be something good (like a game or helpful app) but it's hiding bad stuff inside! That's why you only download from trusted sources!"
    },
    {
      question: "A pop-up says 'Your computer is running slow! Download Speed Booster 3000!' What is this MOST LIKELY?",
      options: [
        "A helpful program I should download",
        "MALWARE disguised as a helper program",
        "A real Microsoft update",
        "Free antivirus software"
      ],
      correct: 1,
      explanation: "Detective skills! üïµÔ∏è This is classic malware bait! Real system updates don't come from pop-ups. These fake 'cleaner' or 'booster' programs ARE the problem! They slow down your computer or steal info. Close and ignore!"
    },
    {
      question: "What does RANSOMWARE do? üò±",
      options: [
        "Sends you random software",
        "Locks your files and demands money to unlock them",
        "Makes your computer run faster",
        "Deletes your browser history"
      ],
      correct: 1,
      explanation: "Exactly right! üò® Ransomware is like a digital kidnapper - it locks all your files (photos, games, homework) and demands payment to unlock them! That's why backing up your important files is so important! Never pay - they rarely unlock your stuff anyway!"
    },
    {
      question: "Which of these is the SAFEST way to download apps on your phone?",
      options: [
        "From random websites offering 'free premium apps'",
        "From official app stores like App Store or Google Play",
        "From links in text messages",
        "From ads on social media"
      ],
      correct: 1,
      explanation: "Perfect choice! üì± Apple App Store and Google Play Store check apps for malware before letting people download them. They're not perfect, but WAY safer than random websites! Read reviews too - other users will warn about sketchy apps!"
    },
    {
      question: "Your antivirus says it found a threat and is removing it. What should you do?",
      options: [
        "Stop it - it might be deleting my games!",
        "Let it remove the threat - that's its job!",
        "Turn off the antivirus",
        "Click 'ignore' to keep the file"
      ],
      correct: 1,
      explanation: "Trust your antivirus! üõ°Ô∏è It's doing exactly what it's supposed to do - protecting you! If it was a false alarm (very rare), you can check the quarantine and restore it. But usually, if antivirus finds something, it's real malware. Let it work!"
    },
    {
      question: "What's the BEST way to protect yourself from malware?",
      options: [
        "Never use the internet",
        "Only use my phone, never a computer",
        "Keep software updated, use antivirus, and think before clicking!",
        "Delete Windows and install nothing"
      ],
      correct: 2,
      explanation: "Perfect strategy! üéØ You don't have to avoid technology - just be SMART! Keep everything updated (patches fix security holes), use antivirus, and think before you click links or download stuff. Knowledge is your best defense! üß†"
    }
  ];

  const handleAnswerClick = (answerIndex) => {
    setSelectedAnswer(answerIndex);
    setShowResult(true);

    if (answerIndex === quizQuestions[currentQuestion].correct) {
      setScore(score + 1);
    }
  };

  const handleNextQuestion = () => {
    if (currentQuestion + 1 < quizQuestions.length) {
      setCurrentQuestion(currentQuestion + 1);
      setSelectedAnswer(null);
      setShowResult(false);
    } else {
      setQuizCompleted(true);
    }
  };

  const resetQuiz = () => {
    setCurrentQuestion(0);
    setScore(0);
    setSelectedAnswer(null);
    setShowResult(false);
    setQuizCompleted(false);
  };

  const styles = {
    container: {
      minHeight: '100vh',
      padding: '2rem',
      paddingTop: '1rem'
    },
    backButton: {
      marginBottom: '2rem'
    },
    header: {
      textAlign: 'center',
      marginBottom: '3rem'
    },
    title: {
      fontSize: 'clamp(2rem, 5vw, 3rem)',
      fontWeight: 'bold',
      marginBottom: '1rem',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      gap: '1rem',
      flexWrap: 'wrap'
    },
    subtitle: {
      fontSize: 'clamp(1rem, 2vw, 1.2rem)',
      color: '#cccccc',
      maxWidth: '800px',
      margin: '0 auto'
    },
    contentGrid: {
      display: 'grid',
      gridTemplateColumns: '1fr',
      gap: '2rem',
      maxWidth: '1200px',
      margin: '0 auto'
    },
    infoSection: {
      background: 'rgba(255, 255, 255, 0.1)',
      backdropFilter: 'blur(20px)',
      borderRadius: '20px',
      border: '1px solid rgba(76, 175, 80, 0.3)',
      padding: 'clamp(1.5rem, 3vw, 2.5rem)',
      marginBottom: '2rem'
    },
    sectionTitle: {
      fontSize: 'clamp(1.3rem, 2.5vw, 1.8rem)',
      fontWeight: 'bold',
      marginBottom: '1rem',
      display: 'flex',
      alignItems: 'center',
      gap: '0.5rem'
    },
    infoGrid: {
      display: 'grid',
      gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
      gap: '1.5rem',
      marginTop: '1.5rem'
    },
    infoCard: {
      background: 'rgba(0, 0, 0, 0.2)',
      padding: '1.5rem',
      borderRadius: '12px',
      border: '1px solid rgba(255, 255, 255, 0.1)',
      transition: 'transform 0.3s ease'
    },
    infoCardIcon: {
      marginBottom: '1rem'
    },
    infoCardTitle: {
      fontSize: '1.1rem',
      fontWeight: 'bold',
      marginBottom: '0.5rem',
      color: '#4caf50'
    },
    infoCardText: {
      fontSize: '0.95rem',
      color: '#cccccc',
      lineHeight: '1.5'
    },
    quizSection: {
      background: 'rgba(255, 255, 255, 0.1)',
      backdropFilter: 'blur(20px)',
      borderRadius: '20px',
      border: '1px solid rgba(76, 175, 80, 0.3)',
      padding: 'clamp(1.5rem, 3vw, 2.5rem)',
      marginBottom: '2rem'
    },
    quizHeader: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '2rem',
      flexWrap: 'wrap',
      gap: '1rem'
    },
    questionNumber: {
      fontSize: '1rem',
      color: '#4caf50',
      fontWeight: 'bold'
    },
    scoreDisplay: {
      fontSize: '1rem',
      color: '#4caf50',
      fontWeight: 'bold',
      display: 'flex',
      alignItems: 'center'
    },
    question: {
      fontSize: 'clamp(1.1rem, 2vw, 1.4rem)',
      fontWeight: 'bold',
      marginBottom: '2rem',
      padding: '1.5rem',
      background: 'rgba(76, 175, 80, 0.1)',
      borderRadius: '12px',
      border: '1px solid rgba(76, 175, 80, 0.3)'
    },
    optionsGrid: {
      display: 'grid',
      gridTemplateColumns: '1fr',
      gap: '1rem'
    },
    option: {
      padding: '1.2rem',
      background: 'rgba(255, 255, 255, 0.05)',
      border: '2px solid rgba(255, 255, 255, 0.2)',
      borderRadius: '10px',
      fontSize: '1rem',
      transition: 'all 0.3s ease',
      cursor: 'pointer'
    },
    optionCorrect: {
      background: 'rgba(76, 175, 80, 0.2)',
      borderColor: '#4caf50',
      boxShadow: '0 0 20px rgba(76, 175, 80, 0.3)'
    },
    optionWrong: {
      background: 'rgba(244, 67, 54, 0.2)',
      borderColor: '#f44336',
      boxShadow: '0 0 20px rgba(244, 67, 54, 0.3)'
    },
    explanation: {
      marginTop: '2rem',
      padding: '1.5rem',
      background: 'rgba(76, 175, 80, 0.1)',
      borderRadius: '12px',
      border: '1px solid rgba(76, 175, 80, 0.3)',
      display: 'flex',
      gap: '1rem',
      alignItems: 'flex-start'
    },
    nextButton: {
      marginTop: '2rem',
      padding: '1rem 2rem',
      background: 'linear-gradient(135deg, #4caf50, #45a049)',
      border: 'none',
      borderRadius: '10px',
      color: 'white',
      fontSize: '1.1rem',
      fontWeight: 'bold',
      cursor: 'pointer',
      transition: 'transform 0.2s ease',
      width: '100%'
    },
    completionCard: {
      textAlign: 'center',
      padding: '2rem'
    },
    completionEmoji: {
      fontSize: '5rem',
      marginBottom: '1rem'
    },
    completionTitle: {
      fontSize: '2rem',
      fontWeight: 'bold',
      marginBottom: '1rem',
      background: 'linear-gradient(45deg, #4caf50, #8bc34a)',
      WebkitBackgroundClip: 'text',
      WebkitTextFillColor: 'transparent'
    },
    completionScore: {
      fontSize: '1.5rem',
      marginBottom: '1rem',
      color: '#4caf50'
    },
    gameSection: {
      background: 'rgba(255, 255, 255, 0.05)',
      backdropFilter: 'blur(10px)',
      borderRadius: '20px',
      border: '1px solid rgba(76, 175, 80, 0.2)',
      padding: 'clamp(2rem, 4vw, 3rem)',
      textAlign: 'center'
    },
    gameComingSoon: {
      fontSize: '5rem',
      marginBottom: '1rem'
    },
    gameTitle: {
      fontSize: 'clamp(1.5rem, 3vw, 2rem)',
      fontWeight: 'bold',
      marginBottom: '1rem',
      color: '#4caf50'
    },
    gameDescription: {
      fontSize: '1.1rem',
      color: '#cccccc',
      maxWidth: '700px',
      margin: '0 auto 2rem',
      lineHeight: '1.6'
    }
  };

  return (
    <div className="cyber-container bg-gradient-primary" style={styles.container}>
      <button 
        className="btn-back"
        style={styles.backButton}
        onClick={() => navigate('/dashboard')}
      >
        <ArrowLeft size={20} />
        Back to Dashboard
      </button>

      <div style={styles.header}>
        <h1 className="text-gradient-secondary" style={styles.title}>
          <Sword size={48} color="#4caf50" />
          Malware Analysis Lab üî¨
          <Bug size={48} color="#4caf50" />
        </h1>
        <p style={styles.subtitle}>
          Learn about computer viruses, trojans, and malware! Become a Malware Hunter! üõ°Ô∏è
        </p>
      </div>

      <div style={styles.contentGrid}>
        {/* Info Section */}
        <div style={styles.infoSection}>
          <h2 style={styles.sectionTitle}>
            <AlertOctagon size={28} color="#4caf50" />
            Understanding Malware ü¶†
          </h2>
          <p style={{...styles.infoCardText, marginBottom: '1.5rem', fontSize: '1.05rem'}}>
            Malware is like digital monsters that live in computers and phones! Some steal passwords, some 
            slow down your device, and some spy on you. BUT - you can protect yourself! Think of antivirus 
            software as your digital superhero that fights these monsters. Let's learn how to stay safe! üí™
          </p>

          <div style={styles.infoGrid}>
            <div 
              style={styles.infoCard}
              onMouseEnter={(e) => e.currentTarget.style.transform = 'translateY(-5px)'}
              onMouseLeave={(e) => e.currentTarget.style.transform = 'translateY(0)'}
            >
              <div style={styles.infoCardIcon}>
                <Bug size={40} color="#4caf50" />
              </div>
              <h3 style={styles.infoCardTitle}>Viruses ü¶†</h3>
              <p style={styles.infoCardText}>
                Computer viruses spread like colds! They attach to files and programs, copy themselves, 
                and spread to other computers. They can delete files, steal info, or make your computer super slow. 
                Keep your antivirus updated to fight them!
              </p>
            </div>

            <div 
              style={styles.infoCard}
              onMouseEnter={(e) => e.currentTarget.style.transform = 'translateY(-5px)'}
              onMouseLeave={(e) => e.currentTarget.style.transform = 'translateY(0)'}
            >
              <div style={styles.infoCardIcon}>
                <Download size={40} color="#ff9800" />
              </div>
              <h3 style={styles.infoCardTitle}>Trojans üê¥</h3>
              <p style={styles.infoCardText}>
                Named after the Trojan Horse from ancient Greece! Trojans pretend to be helpful apps 
                (like "Free Minecraft!" or "Speed Up Your PC!") but they're actually malware in disguise. 
                Only download from official app stores!
              </p>
            </div>

            <div 
              style={styles.infoCard}
              onMouseEnter={(e) => e.currentTarget.style.transform = 'translateY(-5px)'}
              onMouseLeave={(e) => e.currentTarget.style.transform = 'translateY(0)'}
            >
              <div style={styles.infoCardIcon}>
                <Shield size={40} color="#2196f3" />
              </div>
              <h3 style={styles.infoCardTitle}>Stay Protected! üõ°Ô∏è</h3>
              <p style={styles.infoCardText}>
                Your best defenses: Use antivirus software, keep everything updated, think before downloading, 
                don't click suspicious links, and back up your important files! Being careful online is like 
                wearing a seatbelt - it keeps you safe!
              </p>
            </div>
          </div>
        </div>

        {/* Quiz Section */}
        <div style={styles.quizSection}>
          <h2 style={styles.sectionTitle}>
            <Target size={28} color="#4caf50" />
            Test Your Malware Knowledge! üß†
          </h2>

          {!quizCompleted ? (
            <>
              <div style={styles.quizHeader}>
                <span style={styles.questionNumber}>
                  Question {currentQuestion + 1} of {quizQuestions.length}
                </span>
                <span style={styles.scoreDisplay}>
                  <Trophy size={16} style={{display: 'inline', marginRight: '0.5rem'}} />
                  Score: {score}/{quizQuestions.length}
                </span>
              </div>

              <div style={styles.question}>
                {quizQuestions[currentQuestion].question}
              </div>

              <div style={styles.optionsGrid}>
                {quizQuestions[currentQuestion].options.map((option, index) => (
                  <div
                    key={index}
                    style={{
                      ...styles.option,
                      ...(selectedAnswer === index && index === quizQuestions[currentQuestion].correct ? styles.optionCorrect : {}),
                      ...(selectedAnswer === index && index !== quizQuestions[currentQuestion].correct ? styles.optionWrong : {}),
                      ...(showResult && index === quizQuestions[currentQuestion].correct ? styles.optionCorrect : {}),
                      cursor: showResult ? 'default' : 'pointer'
                    }}
                    onClick={() => !showResult && handleAnswerClick(index)}
                    onMouseEnter={(e) => {
                      if (!showResult) {
                        e.currentTarget.style.background = 'rgba(76, 175, 80, 0.1)';
                        e.currentTarget.style.borderColor = '#4caf50';
                        e.currentTarget.style.transform = 'translateX(5px)';
                      }
                    }}
                    onMouseLeave={(e) => {
                      if (!showResult) {
                        e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';
                        e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                        e.currentTarget.style.transform = 'translateX(0)';
                      }
                    }}
                  >
                    {option}
                    {showResult && index === quizQuestions[currentQuestion].correct && (
                      <CheckCircle size={20} color="#4caf50" style={{float: 'right'}} />
                    )}
                    {showResult && selectedAnswer === index && index !== quizQuestions[currentQuestion].correct && (
                      <XCircle size={20} color="#f44336" style={{float: 'right'}} />
                    )}
                  </div>
                ))}
              </div>

              {showResult && (
                <>
                  <div style={styles.explanation}>
                    {selectedAnswer === quizQuestions[currentQuestion].correct ? (
                      <CheckCircle size={24} color="#4caf50" style={{flexShrink: 0}} />
                    ) : (
                      <XCircle size={24} color="#f44336" style={{flexShrink: 0}} />
                    )}
                    <div>
                      <strong style={{display: 'block', marginBottom: '0.5rem', color: selectedAnswer === quizQuestions[currentQuestion].correct ? '#4caf50' : '#f44336'}}>
                        {selectedAnswer === quizQuestions[currentQuestion].correct ? 'Malware Detected! Nice!' : 'Careful! Learn From This!'}
                      </strong>
                      <span style={{color: '#cccccc'}}>
                        {quizQuestions[currentQuestion].explanation}
                      </span>
                    </div>
                  </div>

                  <button
                    style={styles.nextButton}
                    onClick={handleNextQuestion}
                    onMouseEnter={(e) => e.target.style.transform = 'scale(1.02)'}
                    onMouseLeave={(e) => e.target.style.transform = 'scale(1)'}
                  >
                    {currentQuestion + 1 < quizQuestions.length ? 'Next Question' : 'See Results'} ‚Üí
                  </button>
                </>
              )}
            </>
          ) : (
            <div style={styles.completionCard}>
              <div style={styles.completionEmoji}>
                {score === quizQuestions.length ? 'üèÜ' : score >= quizQuestions.length * 0.7 ? 'üåü' : 'ü¶†'}
              </div>
              <h3 style={styles.completionTitle}>
                {score === quizQuestions.length ? 'Perfect! Malware Master!' : score >= quizQuestions.length * 0.7 ? 'Awesome! Malware Hunter!' : 'Keep Training, Warrior!'}
              </h3>
              <p style={styles.completionScore}>
                You scored {score} out of {quizQuestions.length}! üéØ
              </p>
              <p style={{...styles.infoCardText, marginBottom: '2rem'}}>
                {score === quizQuestions.length 
                  ? "üéâ INCREDIBLE! You know EVERYTHING about malware! You could teach a class on this! Your computer is safe with you protecting it! üõ°Ô∏è" 
                  : score >= quizQuestions.length * 0.7
                  ? "‚≠ê Great job! You know how to spot and avoid most malware! Review the tricky questions and you'll be a total expert. Stay safe out there!"
                  : "üöÄ You're learning! Malware can be tricky, but now you know more than before. Take the quiz again and watch yourself improve! Knowledge = Power!"}
              </p>
              <button
                style={styles.nextButton}
                onClick={resetQuiz}
                onMouseEnter={(e) => e.target.style.transform = 'scale(1.02)'}
                onMouseLeave={(e) => e.target.style.transform = 'scale(1)'}
              >
                <Zap size={20} style={{display: 'inline', marginRight: '0.5rem'}} />
                Hunt More Malware! üîÑ
              </button>
            </div>
          )}
        </div>

        {/* Interactive Game Section - Coming Soon */}
        <div style={styles.gameSection}>
          <div style={styles.gameComingSoon}>üéÆ</div>
          <h2 style={styles.gameTitle}>
            Virus Hunter Battle Game! ‚öîÔ∏è
          </h2>
          <p style={styles.gameDescription}>
            Gear up for an epic battle against digital monsters! Hunt down viruses, quarantine trojans, 
            and defend computers from malware attacks. Upgrade your antivirus weapons and become the 
            ultimate Malware Hunter. This is gonna be AWESOME! üî•
          </p>
          <div style={{
            padding: '2rem',
            background: 'rgba(0, 0, 0, 0.2)',
            borderRadius: '12px',
            border: '2px dashed rgba(76, 175, 80, 0.5)'
          }}>
            <Zap size={48} color="#4caf50" style={{marginBottom: '1rem'}} />
            <h3 style={{fontSize: '1.2rem', color: '#4caf50', marginBottom: '0.5rem'}}>
              Under Construction! üöß
            </h3>
            <p style={{color: '#999', fontSize: '0.9rem'}}>
              Our virus hunters are coding this game right now! Check back soon for epic malware battles!
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}